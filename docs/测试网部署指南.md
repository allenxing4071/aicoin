# 🧪 AIcoin v2.0 测试网部署指南

> **版本**: v2.0  
> **状态**: ✅ 已完成核心开发（90%）  
> **目标**: 在Hyperliquid测试网验证系统

---

## 📋 测试前检查清单

### 1. 环境准备

- [ ] Docker & Docker Compose已安装
- [ ] 已获取DeepSeek API Key
- [ ] 已获取Hyperliquid测试网账户
- [ ] （可选）已获取OpenAI API Key（用于向量化）

### 2. Hyperliquid测试网申请

1. 访问：https://app.hyperliquid-testnet.xyz/
2. 连接钱包创建测试网账户
3. 记录你的钱包地址和私钥
4. 免费领取测试币（无需真实资金）

---

## 🚀 快速启动（3步）

### 步骤1: 配置环境变量

```bash
# 复制示例配置
cp .env.testnet.example .env.testnet

# 编辑配置文件
vim .env.testnet  # 或使用其他编辑器
```

**必填配置**:
```bash
# DeepSeek API Key (必需)
DEEPSEEK_API_KEY=sk-your-deepseek-api-key-here

# Hyperliquid测试网配置 (必需)
HYPERLIQUID_WALLET_ADDRESS=0xYourTestnetWalletAddress
HYPERLIQUID_PRIVATE_KEY=0xYourTestnetPrivateKey
HYPERLIQUID_TESTNET=true

# OpenAI API Key (可选，用于Qdrant向量化)
OPENAI_API_KEY=sk-your-openai-api-key-here

# 交易开关 (先设置为false观察)
TRADING_ENABLED=false
```

### 步骤2: 启动系统

```bash
# 给脚本添加执行权限
chmod +x start_testnet.sh

# 启动测试网
./start_testnet.sh
```

### 步骤3: 验证运行

```bash
# 查看系统状态
curl http://localhost:8000/health

# 查看API文档
open http://localhost:8000/docs

# 查看实时日志
docker-compose -f docker-compose.testnet.yml logs -f backend
```

---

## 📊 监控和验证

### 查看日志

```bash
# 实时日志（带emoji过滤）
docker-compose -f docker-compose.testnet.yml logs -f backend | grep -E '(🔄|✅|❌|⚠️|🤖|📊)'

# 查看决策记录
docker-compose -f docker-compose.testnet.yml logs backend | grep '决策'

# 查看权限变化
docker-compose -f docker-compose.testnet.yml logs backend | grep '权限'

# 查看风控触发
docker-compose -f docker-compose.testnet.yml logs backend | grep '约束'
```

### 关键检查点

#### 1. 启动检查（前5分钟）

- [ ] PostgreSQL启动成功
- [ ] Redis启动成功
- [ ] Qdrant启动成功
- [ ] Backend启动成功
- [ ] DecisionEngineV2初始化成功
- [ ] OrchestratorV2启动成功
- [ ] 权限等级显示为L1

#### 2. 决策循环检查（5-30分钟）

- [ ] 每5分钟触发一次决策
- [ ] AI能正常调用LLM
- [ ] 约束验证正常工作
- [ ] 权限检查正常工作
- [ ] 记忆系统正常记录

#### 3. 风控检查（持续）

- [ ] 硬约束能阻止高风险交易
- [ ] 软约束能调整交易参数
- [ ] 权限系统能正常升降级
- [ ] 强制平仓触发器正常

---

## 🧪 测试场景

### 场景1: 观察模式（TRADING_ENABLED=false）

**目的**: 验证系统能正常运行，AI能给出决策建议

**步骤**:
1. 保持 `TRADING_ENABLED=false`
2. 启动系统，运行24小时
3. 观察AI决策建议
4. 检查日志无严重错误

**验收标准**:
- ✅ 系统稳定运行24小时
- ✅ 每5分钟正常决策
- ✅ AI决策逻辑合理
- ✅ 无严重错误

### 场景2: 测试网交易（TRADING_ENABLED=true）

**目的**: 在测试网进行真实交易测试

**步骤**:
1. 确认场景1通过
2. 修改 `.env.testnet`:
   ```bash
   TRADING_ENABLED=true
   INITIAL_PERMISSION_LEVEL=L1
   ```
3. 重启系统:
   ```bash
   docker-compose -f docker-compose.testnet.yml restart backend
   ```
4. 密切监控6-24小时

**验收标准**:
- ✅ 能在测试网成功下单
- ✅ 止损/止盈正常触发
- ✅ 权限系统正常工作
- ✅ 风控保护生效
- ✅ 6小时内无触发强制平仓
- ✅ 最大回撤 < 10%

---

## 🔍 故障排查

### 问题1: Backend启动失败

**现象**: backend容器反复重启

**排查步骤**:
```bash
# 查看错误日志
docker-compose -f docker-compose.testnet.yml logs backend | tail -100

# 常见原因：
# 1. API Key未配置
# 2. 数据库连接失败
# 3. Redis连接失败
# 4. Qdrant连接失败
```

**解决方案**:
- 检查 `.env.testnet` 配置
- 确认依赖服务已启动
- 查看具体错误信息

### 问题2: AI决策失败

**现象**: 日志显示 "❌ 决策失败"

**排查步骤**:
```bash
# 查看详细错误
docker-compose -f docker-compose.testnet.yml logs backend | grep "决策失败" -A 10

# 常见原因：
# 1. DeepSeek API Key无效
# 2. LLM调用超时
# 3. Prompt构建失败
```

**解决方案**:
- 验证DeepSeek API Key
- 检查网络连接
- 查看LLM响应内容

### 问题3: Qdrant连接失败

**现象**: "❌ Qdrant connection failed"

**排查步骤**:
```bash
# 检查Qdrant状态
docker-compose -f docker-compose.testnet.yml ps qdrant

# 访问Qdrant Dashboard
open http://localhost:6333/dashboard
```

**解决方案**:
- 重启Qdrant: `docker-compose -f docker-compose.testnet.yml restart qdrant`
- 检查端口占用
- 查看Qdrant日志

---

## ⚠️  重要提醒

### 测试网限制

- ✅ 测试网环境，无真实资金风险
- ✅ 测试币免费，可随意测试
- ⚠️  测试网性能可能不稳定
- ⚠️  测试网数据可能被重置

### 从测试网到主网的路径

**不要急于上主网！** 遵循以下步骤：

1. **测试网观察模式** (1-2天)
   - TRADING_ENABLED=false
   - 验证系统稳定性

2. **测试网交易模式** (3-7天)
   - TRADING_ENABLED=true
   - 小仓位测试
   - 验证风控有效性

3. **主网小资金验证** (1-3天)
   - 从$100开始
   - HYPERLIQUID_TESTNET=false
   - 极度谨慎

4. **逐步扩大** (视表现而定)
   - 表现良好才增加资金
   - 持续监控风险指标
   - 随时准备停止

---

## 📊 测试网数据查看

### API端点

```bash
# 健康检查
curl http://localhost:8000/health

# 系统状态
curl http://localhost:8000/api/v1/status

# AI状态
curl http://localhost:8000/api/v1/ai/status

# 账户信息
curl http://localhost:8000/api/v1/account/balance

# 持仓信息
curl http://localhost:8000/api/v1/account/positions
```

### Qdrant Dashboard

访问: http://localhost:6333/dashboard

- 查看向量数据库
- 验证记忆存储
- 检查相似场景检索

---

## 🛑 紧急停止

如果发现任何问题，立即停止：

```bash
# 停止所有容器
docker-compose -f docker-compose.testnet.yml down

# 或使用紧急停止脚本
./stop_system_emergency.sh
```

---

## ✅ 测试通过标准

在考虑主网之前，必须满足：

### 稳定性（必需）

- [ ] 测试网运行7天无严重错误
- [ ] 决策循环稳定，无频繁崩溃
- [ ] 内存和CPU使用正常

### 功能性（必需）

- [ ] AI决策逻辑合理
- [ ] 风控机制有效触发
- [ ] 权限系统正常升降级
- [ ] 记忆系统正常记录和检索

### 风险控制（必需）

- [ ] 最大回撤 < 10%
- [ ] 单日亏损 < 5%
- [ ] 杠杆 ≤ 5x
- [ ] 无触发强制平仓（测试网）

### 性能指标（建议）

- [ ] 胜率 > 50%
- [ ] 夏普比率 > 0.5
- [ ] 盈亏比 > 1:1
- [ ] 交易频率合理（不过度交易）

---

## 📝 测试日志模板

建议记录每次测试的关键信息：

```markdown
## 测试记录 - [日期]

### 配置
- TRADING_ENABLED: [true/false]
- INITIAL_PERMISSION_LEVEL: [L1/L2/...]
- DECISION_INTERVAL: [300s]

### 运行时长
- 开始: [时间]
- 结束: [时间]
- 总计: [X小时]

### 关键指标
- 总决策次数: [X]
- 通过决策: [X]
- 拒绝决策: [X]
- 最大回撤: [X%]
- 当前权限: [LX]

### 问题记录
1. [描述问题]
2. [描述问题]

### 结论
[通过/失败 + 原因]
```

---

## 🎯 下一步

测试网验证通过后：

1. **总结测试结果**
   - 记录所有问题和解决方案
   - 评估系统表现
   - 确认是否满足上主网条件

2. **主网准备**
   - 准备主网钱包（新钱包，小资金）
   - 配置主网环境
   - 制定应急预案

3. **主网试运行**
   - 从$100开始
   - 前24小时密切监控
   - 逐步增加资金

---

**Good luck testing! 🧪**

**记住：测试网是用来犯错的，主网是用来赚钱的。不要跳过测试网！**

