# v3.1 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

> **ç‰ˆæœ¬**: v3.1 - å¤šäº¤æ˜“æ‰€é›†æˆ  
> **æ›´æ–°æ—¶é—´**: 2025-11-05  
> **é¢„è®¡é˜…è¯»**: 5åˆ†é’Ÿ

## ğŸ¯ v3.1 æ ¸å¿ƒç‰¹æ€§

- âœ¨ **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: Binance + Hyperliquid
- ğŸ“Š **å¤šæ—¶é—´å‘¨æœŸåˆ†æ**: 6ä¸ªæ—¶é—´å‘¨æœŸåŒæ—¶å±•ç¤º
- ğŸ”„ **çƒ­åˆ‡æ¢**: æ— éœ€é‡å¯å³å¯åˆ‡æ¢äº¤æ˜“æ‰€
- ğŸ’¹ **ç°è´§åˆçº¦å¯¹æ¯”**: å¥—åˆ©æœºä¼šåˆ†æ

---

## ğŸš€ 30ç§’å¿«é€Ÿå¯åŠ¨

```bash
# 1. å¯åŠ¨Dockerç¯å¢ƒ
open -a Docker && sleep 5

# 2. å¯åŠ¨æ•°æ®åº“
cd AIcoin
docker-compose up -d postgres

# 3. é…ç½®ç¯å¢ƒå˜é‡ (é¦–æ¬¡ä½¿ç”¨)
cd backend
cat > .env << 'ENVFILE'
DATABASE_URL=postgresql://aicoin:aicoin_secure_password_2024@localhost:5433/aicoin
HYPERLIQUID_WALLET_ADDRESS=0xYourAddress
HYPERLIQUID_PRIVATE_KEY=0xYourPrivateKey
BINANCE_API_KEY=YourApiKey
BINANCE_API_SECRET=YourApiSecret
ENVFILE

# 4. è¿è¡Œæ•°æ®åº“è¿ç§» (é¦–æ¬¡ä½¿ç”¨)
alembic upgrade head

# 5. å¯åŠ¨åç«¯
python3 -m uvicorn app.main:app --reload --port 8000 &

# 6. å¯åŠ¨å‰ç«¯
cd ../frontend && npm run dev &

# âœ… å®Œæˆ! è®¿é—® http://localhost:3000
```

---

## ğŸ“‹ åˆ†æ­¥æ“ä½œæŒ‡å—

### æ­¥éª¤1: é…ç½®APIå¯†é’¥

#### Binance (ç°è´§+åˆçº¦)

```bash
# backend/.env
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_api_secret_here
BINANCE_TESTNET=false  # true=æµ‹è¯•ç½‘, false=ä¸»ç½‘
```

**è·å–Binance APIå¯†é’¥**:
1. ç™»å½• [Binance](https://www.binance.com)
2. ç”¨æˆ·ä¸­å¿ƒ â†’ APIç®¡ç† â†’ åˆ›å»ºAPI
3. å¯ç”¨"ç°è´§äº¤æ˜“"å’Œ"åˆçº¦äº¤æ˜“"æƒé™
4. ç»‘å®šIPç™½åå•(æ¨è)

#### Hyperliquid (æ°¸ç»­åˆçº¦)

```bash
# backend/.env
HYPERLIQUID_WALLET_ADDRESS=0x...
HYPERLIQUID_PRIVATE_KEY=0x...
HYPERLIQUID_TESTNET=false
```

**è·å–Hyperliquidé’±åŒ…**:
1. è®¿é—® [Hyperliquid](https://app.hyperliquid.xyz)
2. è¿æ¥MetaMaskæˆ–å…¶ä»–é’±åŒ…
3. å¯¼å‡ºé’±åŒ…ç§é’¥ âš ï¸ å¦¥å–„ä¿ç®¡!

### æ­¥éª¤2: åˆ‡æ¢äº¤æ˜“æ‰€

#### æ–¹æ³•1: APIè°ƒç”¨

```bash
# åˆ‡æ¢åˆ°Binanceç°è´§
curl -X POST "http://localhost:8000/api/v1/exchanges/switch?exchange_name=binance&market_type=spot"

# åˆ‡æ¢åˆ°Hyperliquidæ°¸ç»­
curl -X POST "http://localhost:8000/api/v1/exchanges/switch?exchange_name=hyperliquid&market_type=perpetual"
```

#### æ–¹æ³•2: å‰ç«¯ç•Œé¢

```
1. è®¿é—® http://localhost:3000/admin/exchanges
2. ç‚¹å‡»"åˆ‡æ¢äº¤æ˜“æ‰€"æŒ‰é’®
3. é€‰æ‹©äº¤æ˜“æ‰€å’Œå¸‚åœºç±»å‹
4. ç¡®è®¤åˆ‡æ¢
```

### æ­¥éª¤3: ä½¿ç”¨å¤šå‘¨æœŸåˆ†æ

#### Pythonç¤ºä¾‹

```python
import httpx
import asyncio

async def analyze_multi_timeframe():
    async with httpx.AsyncClient() as client:
        # è·å–BTCçš„6ä¸ªæ—¶é—´å‘¨æœŸæ•°æ®
        response = await client.get(
            "http://localhost:8000/api/v1/market/klines/multi",
            params={
                "symbol": "BTC",
                "intervals": "1m,5m,15m,1h,4h,1d",
                "limit": 100
            }
        )
        
        data = response.json()
        
        # åˆ†æçŸ­æœŸè¶‹åŠ¿ (1åˆ†é’Ÿ)
        klines_1m = data['data']['1m']
        latest_1m = klines_1m[-1]
        print(f"1åˆ†é’Ÿæœ€æ–°ä»·: {latest_1m['close']}")
        
        # åˆ†æé•¿æœŸè¶‹åŠ¿ (1å¤©)
        klines_1d = data['data']['1d']
        latest_1d = klines_1d[-1]
        print(f"1å¤©æœ€æ–°ä»·: {latest_1d['close']}")
        
        # åˆ¤æ–­è¶‹åŠ¿ä¸€è‡´æ€§
        if float(latest_1m['close']) > float(latest_1d['close']):
            print("ğŸ“ˆ å¤šå‘¨æœŸä¸Šæ¶¨è¶‹åŠ¿")

asyncio.run(analyze_multi_timeframe())
```

#### JavaScriptç¤ºä¾‹

```javascript
// è·å–å¤šå‘¨æœŸKçº¿
async function getMultiTimeframeData(symbol) {
  const response = await fetch(
    `http://localhost:8000/api/v1/market/klines/multi?symbol=${symbol}&intervals=1m,5m,1h`
  );
  
  const { data } = await response.json();
  
  console.log('1åˆ†é’ŸKçº¿:', data['1m']);
  console.log('5åˆ†é’ŸKçº¿:', data['5m']);
  console.log('1å°æ—¶Kçº¿:', data['1h']);
}

getMultiTimeframeData('BTC');
```

### æ­¥éª¤4: ç°è´§åˆçº¦å¥—åˆ©åˆ†æ

```bash
# è·å–BTCç°è´§åˆçº¦å¯¹æ¯”
curl "http://localhost:8000/api/v1/market/spot-futures-compare?symbol=BTC&interval=1h"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "comparison": {
      "current_spread": "20.00",
      "spread_percentage": "0.029%",
      "funding_rate": "0.0001",
      "arbitrage_opportunity": false
    }
  }
}
```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶ä½¿ç”¨

### ExchangeSelector (äº¤æ˜“æ‰€é€‰æ‹©å™¨)

```tsx
import { ExchangeSelector } from '@/components/exchange/ExchangeSelector';

export default function TradingPage() {
  return (
    <div>
      <ExchangeSelector 
        onExchangeChange={(exchange, marketType) => {
          console.log(`åˆ‡æ¢åˆ°: ${exchange} (${marketType})`);
        }}
      />
    </div>
  );
}
```

### MultiTimeframeChart (å¤šå‘¨æœŸå›¾è¡¨)

```tsx
import { MultiTimeframeChart } from '@/components/charts/MultiTimeframeChart';

export default function AnalysisPage() {
  return (
    <MultiTimeframeChart
      symbol="BTC"
      intervals={['1m', '5m', '15m', '1h', '4h', '1d']}
      autoRefresh={true}
      refreshInterval={30000}  // 30ç§’åˆ·æ–°
    />
  );
}
```

---

## ğŸ” å¸¸ç”¨APIç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/v1/exchanges` | GET | è·å–æ‰€æœ‰äº¤æ˜“æ‰€é…ç½® |
| `/api/v1/exchanges/active` | GET | è·å–å½“å‰æ¿€æ´»çš„äº¤æ˜“æ‰€ |
| `/api/v1/exchanges/switch` | POST | åˆ‡æ¢äº¤æ˜“æ‰€ |
| `/api/v1/market/klines/multi` | GET | è·å–å¤šå‘¨æœŸKçº¿ |
| `/api/v1/market/spot-futures-compare` | GET | ç°è´§åˆçº¦å¯¹æ¯” |

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨å¹¶å‘è¯·æ±‚

```python
# âŒ ä¸æ¨è: ä¸²è¡Œè¯·æ±‚ (è€—æ—¶çº¦600ms)
klines_1m = await get_klines("BTC", "1m")
klines_5m = await get_klines("BTC", "5m")
klines_1h = await get_klines("BTC", "1h")

# âœ… æ¨è: å¹¶å‘è¯·æ±‚ (è€—æ—¶çº¦200ms)
tasks = [
    get_klines("BTC", "1m"),
    get_klines("BTC", "5m"),
    get_klines("BTC", "1h")
]
results = await asyncio.gather(*tasks)
```

### 2. ç¼“å­˜ç­–ç•¥

```python
# çŸ­å‘¨æœŸ(1m, 5m): 30ç§’ç¼“å­˜
# é•¿å‘¨æœŸ(1h, 4h, 1d): 5åˆ†é’Ÿç¼“å­˜
```

### 3. æ•°æ®åº“è¿æ¥æ± 

```python
# backend/app/core/database.py
engine = create_async_engine(
    settings.DATABASE_URL,
    pool_size=20,      # è¿æ¥æ± å¤§å°
    max_overflow=10,   # æœ€å¤§æº¢å‡º
    pool_pre_ping=True # è¿æ¥ä¿æ´»
)
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: åˆ‡æ¢äº¤æ˜“æ‰€å¤±è´¥

**é”™è¯¯**: `åˆ‡æ¢äº¤æ˜“æ‰€å¤±è´¥`

**åŸå› **: APIå¯†é’¥æœªé…ç½®

**è§£å†³**:
```bash
# æ£€æŸ¥.envæ–‡ä»¶
cat backend/.env | grep BINANCE_API_KEY

# ç¡®è®¤é…ç½®åé‡å¯æœåŠ¡
lsof -ti:8000 | xargs kill -9
python3 -m uvicorn app.main:app --reload --port 8000
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Connection refused (port 5432)`

**åŸå› **: ç«¯å£é…ç½®é”™è¯¯

**è§£å†³**:
```bash
# ä¿®æ”¹backend/app/core/config.py
DATABASE_URL = "postgresql://aicoin:password@localhost:5433/aicoin"
                                                    # ^^^^^ ç¡®è®¤æ˜¯5433
```

### Q3: å¤šå‘¨æœŸAPIè¿”å›ç©ºæ•°æ®

**é”™è¯¯**: `data['1m'] is None`

**åŸå› **: å½“å‰äº¤æ˜“æ‰€ä¸æ”¯æŒè¯¥å‘¨æœŸ

**è§£å†³**:
```bash
# æ£€æŸ¥æ”¯æŒçš„å‘¨æœŸ
curl http://localhost:8000/api/v1/exchanges/active

# ä½¿ç”¨æ”¯æŒçš„å‘¨æœŸ
intervals=1m,5m,15m  # è€Œä¸æ˜¯ 1s, 10s
```

---

## ğŸ“š æ›´å¤šèµ„æº

- ğŸ“– [æŠ€æœ¯æ¶æ„æ–‡æ¡£](../03-æŠ€æœ¯æ¶æ„/07-å¤šäº¤æ˜“æ‰€é›†æˆæ¶æ„.md)
- ğŸ”Œ [APIæ¥å£æ–‡æ¡£](../09-APIæ¥å£æ–‡æ¡£/)
- ğŸ¨ [å‰ç«¯ç»„ä»¶æ–‡æ¡£](../08-å‰ç«¯ç³»ç»Ÿ/05-äº¤æ˜“æ‰€ç»„ä»¶.md)
- ğŸš€ [éƒ¨ç½²é…ç½®æŒ‡å—](../07-éƒ¨ç½²è¿ç»´/äº¤æ˜“æ‰€é…ç½®æŒ‡å—.md)

---

## ğŸ‰ ä¸‹ä¸€æ­¥

1. âœ… é…ç½®å¥½APIå¯†é’¥
2. âœ… æµ‹è¯•äº¤æ˜“æ‰€åˆ‡æ¢
3. âœ… å°è¯•å¤šå‘¨æœŸåˆ†æ
4. âœ… å¼€å‘è‡ªå·±çš„äº¤æ˜“ç­–ç•¥
5. âœ… è®¿é—®å‰ç«¯ç®¡ç†ç•Œé¢

**ç¥æ‚¨äº¤æ˜“æ„‰å¿«! ğŸš€**
