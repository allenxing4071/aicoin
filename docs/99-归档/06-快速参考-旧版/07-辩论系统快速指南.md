# 辩论系统快速指南

## 📋 概述

辩论系统是 AIcoin v3.4 的核心功能，通过多空分析师的对抗性辩论提升决策质量。

## 🚀 快速开始

### 1. 检查配置状态

访问管理后台：https://jifenpay.cc/admin/debate/config

**如果看到配置参数**：✅ 系统已就绪
**如果页面为空**：需要初始化配置（见下方）

### 2. 初始化配置（仅首次）

如果配置页面为空，执行以下命令：

```bash
# SSH 到服务器
ssh -i ssh-configs/cloud-servers/AIcoin.pem root@47.250.132.166

# 进入数据库容器
docker exec -i aicoin-postgres psql -U aicoin -d aicoin

# 插入配置数据
INSERT INTO debate_config (config_key, config_value, description) VALUES
('debate_enabled', 'true', '是否启用辩论机制'),
('max_debate_rounds', '1', '最大辩论轮次（1-3）'),
('min_position_size', '1000', '触发辩论的最小仓位金额（USD）'),
('min_permission_level', 'L3', '触发辩论的最低权限等级'),
('debate_timeout_seconds', '60', '辩论超时时间（秒）'),
('use_memory', 'true', '是否使用历史记忆'),
('daily_limit', '100', '每日最大辩论次数'),
('hourly_limit', '10', '每小时最大辩论次数')
ON CONFLICT (config_key) DO NOTHING;

# 验证配置
SELECT config_key, config_value FROM debate_config;

# 退出
\q
exit
```

### 3. 配置参数说明

| 参数 | 默认值 | 说明 | 建议 |
|------|--------|------|------|
| **debate_enabled** | true | 是否启用辩论 | 生产环境：true |
| **max_debate_rounds** | 1 | 辩论轮次 | 1轮（成本低）<br>2-3轮（质量高） |
| **min_position_size** | 1000 | 最小仓位（USD） | 新系统：1000<br>成熟系统：500 |
| **min_permission_level** | L3 | 最低权限等级 | 保守：L3-L4<br>激进：L1-L2 |
| **debate_timeout_seconds** | 60 | 超时时间（秒） | 通常：60<br>慢速 API：90 |
| **use_memory** | true | 使用历史记忆 | 建议：true |
| **daily_limit** | 100 | 每日最大次数 | 根据预算调整 |
| **hourly_limit** | 10 | 每小时最大次数 | 防止突发消耗 |

## 🎯 触发条件

辩论系统在以下条件**全部满足**时自动触发：

```
✅ debate_enabled = true
✅ 仓位金额 ≥ min_position_size
✅ 权限等级 ≥ min_permission_level
✅ 未超过限流限制
```

### 示例场景

**场景 1：会触发辩论** ✅
- 仓位：$1,500
- 权限：L3
- 限流：今日 50/100 次
- 结果：✅ 触发辩论

**场景 2：不会触发** ❌
- 仓位：$800（< $1000）
- 权限：L3
- 结果：❌ 仓位不足

**场景 3：不会触发** ❌
- 仓位：$2,000
- 权限：L2（< L3）
- 结果：❌ 权限不够

## 📊 查看辩论结果

### 1. 辩论历史
- 路径：`/admin/debate`
- 功能：查看所有辩论记录
- 筛选：按币种、推荐结果筛选

### 2. 辩论详情
- 路径：`/admin/debate/{id}`
- 功能：查看完整辩论过程
- 内容：多头论点、空头论点、经理综合判断

### 3. 辩论统计
- 路径：`/admin/debate/statistics`
- 功能：统计数据和趋势分析
- 图表：饼图、折线图、柱状图

### 4. 记忆管理
- 路径：`/admin/debate/memory`
- 功能：查看记忆状态和限流
- 操作：清空记忆、重置限流

## 💡 常见问题

### Q1: 配置页面为空？

**原因**：数据库未初始化配置数据

**解决**：执行上方"初始化配置"步骤

### Q2: 辩论未触发？

**检查清单**：
1. ✅ 配置是否启用（debate_enabled = true）
2. ✅ 仓位是否足够（≥ min_position_size）
3. ✅ 权限是否足够（≥ min_permission_level）
4. ✅ 是否达到限流（查看记忆管理页面）

### Q3: 如何降低触发阈值？

在配置页面修改：
- 降低 `min_position_size`（如 1000 → 500）
- 降低 `min_permission_level`（如 L3 → L2）

### Q4: 如何提高辩论质量？

在配置页面修改：
- 增加 `max_debate_rounds`（如 1 → 2）
- 确保 `use_memory` = true
- 让系统运行 1-2 周积累记忆

### Q5: 如何控制成本？

在配置页面修改：
- 降低 `daily_limit`（如 100 → 50）
- 降低 `hourly_limit`（如 10 → 5）
- 提高 `min_position_size`（如 1000 → 2000）

## 🔧 调试技巧

### 1. 查看后端日志

```bash
# SSH 到服务器
ssh -i ssh-configs/cloud-servers/AIcoin.pem root@47.250.132.166

# 查看后端日志
docker logs aicoin-backend --tail 100 | grep -i debate

# 实时监控
docker logs -f aicoin-backend | grep -i debate
```

### 2. 查看数据库记录

```bash
# 进入数据库
docker exec -i aicoin-postgres psql -U aicoin -d aicoin

# 查看辩论历史
SELECT id, symbol, final_recommendation, confidence, created_at 
FROM debate_history 
ORDER BY created_at DESC 
LIMIT 10;

# 查看配置
SELECT * FROM debate_config;

# 退出
\q
```

### 3. 手动触发辩论（测试）

```bash
# 使用 API 手动触发
curl -X POST http://localhost:8000/api/v1/debate/trigger \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "BTC",
    "position_size_usd": 2000,
    "permission_level": "L3"
  }'
```

## 📈 性能指标

### 预期表现

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 决策质量提升 | 15-20% | 相比无辩论 |
| 风险识别提升 | 50% | 发现潜在风险 |
| 平均延迟 | < 15秒 | 单次辩论 |
| 月度成本 | < $2 | API 调用费用 |
| ROI | > 10,000% | 投资回报率 |

### 监控建议

1. **每日检查**：辩论统计页面
2. **每周分析**：共识度和置信度趋势
3. **每月审查**：辩论历史，总结经验
4. **成本监控**：限流状态，避免超支

## 🎓 最佳实践

### 1. 新系统启动

```yaml
阶段 1（第 1 周）：
  - debate_enabled: true
  - max_debate_rounds: 1
  - min_position_size: 1000
  - min_permission_level: L3
  - 目标：观察系统行为

阶段 2（第 2-4 周）：
  - 根据统计数据调整参数
  - 逐步降低触发阈值
  - 目标：积累记忆数据

阶段 3（第 5 周+）：
  - max_debate_rounds: 2
  - min_position_size: 500
  - 目标：最大化决策质量
```

### 2. 成本优化

```yaml
低预算（< $1/月）：
  - daily_limit: 30
  - hourly_limit: 3
  - min_position_size: 2000
  - max_debate_rounds: 1

中预算（$1-5/月）：
  - daily_limit: 100
  - hourly_limit: 10
  - min_position_size: 1000
  - max_debate_rounds: 1

高预算（> $5/月）：
  - daily_limit: 200
  - hourly_limit: 20
  - min_position_size: 500
  - max_debate_rounds: 2
```

### 3. 质量优化

```yaml
提升决策质量：
  1. 确保 use_memory = true
  2. 让系统运行至少 2 周
  3. 定期查看辩论历史，学习经验
  4. 根据市场情况调整参数

提升风险识别：
  1. 增加辩论轮次（1 → 2）
  2. 关注共识度低的辩论（< 0.5）
  3. 重点审查空头论点
  4. 结合情报系统数据
```

## 📚 相关文档

- [辩论系统技术文档](../03-技术架构/09-辩论系统.md)
- [辩论系统界面预览](../03-技术架构/09-辩论系统-界面预览.md)
- [系统架构设计](../03-技术架构/00-系统架构设计.md)
- [权限等级管理](../03-技术架构/05-权限等级管理系统.md)

## 🆘 获取帮助

如遇问题，请：
1. 查看本文档的"常见问题"部分
2. 查看后端日志（见"调试技巧"）
3. 检查数据库配置（见"调试技巧"）
4. 联系技术支持

---

**最后更新**: 2025-11-14
**版本**: v3.4.0

