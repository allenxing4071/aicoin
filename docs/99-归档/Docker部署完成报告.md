# ğŸ³ AIcoin v2.0 Dockeréƒ¨ç½²å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-01  
**ç‰ˆæœ¬**: v2.0.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

### 1. Dockeré…ç½®æ–‡ä»¶

#### åç«¯Dockerfile
- **è·¯å¾„**: `backend/Dockerfile`
- **åŸºç¡€é•œåƒ**: `python:3.11-slim`
- **åŠŸèƒ½**: 
  - å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆgcc, postgresql-clientï¼‰
  - å®‰è£…Pythonä¾èµ–
  - åˆ›å»ºæ—¥å¿—ç›®å½•
  - æš´éœ²8000ç«¯å£

#### å‰ç«¯Dockerfile
- **è·¯å¾„**: `frontend/Dockerfile`
- **åŸºç¡€é•œåƒ**: `node:18-alpine`
- **åŠŸèƒ½**: 
  - å¤šé˜¶æ®µæ„å»ºï¼ˆbuilder + runnerï¼‰
  - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
  - æš´éœ²3000ç«¯å£

#### .dockerignoreæ–‡ä»¶
- `backend/.dockerignore` - æ’é™¤Pythonç¼“å­˜ã€æ—¥å¿—ç­‰
- `frontend/.dockerignore` - æ’é™¤node_modulesã€.nextç­‰

### 2. Docker Composeé…ç½®

#### æµ‹è¯•ç½‘é…ç½®
- **æ–‡ä»¶**: `docker-compose.testnet.yml`
- **æœåŠ¡**:
  - PostgreSQL (ç«¯å£5433)
  - Redis (ç«¯å£6379)
  - Qdrant (ç«¯å£6333/6334)
  - Backend (ç«¯å£8000)
- **ç‰¹ç‚¹**: ä½¿ç”¨testnet APIï¼Œå¼€å‘æ¨¡å¼

#### ç”Ÿäº§ç¯å¢ƒé…ç½®
- **æ–‡ä»¶**: `docker-compose.prod.yml`
- **æœåŠ¡**:
  - PostgreSQL (ç«¯å£5432)
  - Redis (å¸¦å¯†ç ä¿æŠ¤)
  - Qdrant (ç«¯å£6333/6334)
  - Backend (4 workers)
  - Frontend (ç«¯å£3000)
  - Nginx (ç«¯å£80/443)
- **ç‰¹ç‚¹**: ç”Ÿäº§ä¼˜åŒ–ï¼Œå¤šworkerï¼Œåå‘ä»£ç†

### 3. Nginxé…ç½®

#### é…ç½®æ–‡ä»¶
- **è·¯å¾„**: `nginx/nginx.conf`
- **åŠŸèƒ½**:
  - HTTP/HTTPSæ”¯æŒ
  - Gzipå‹ç¼©
  - åå‘ä»£ç†ï¼ˆBackend + Frontendï¼‰
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - SSLé…ç½®ï¼ˆå¯é€‰ï¼‰

### 4. éƒ¨ç½²è„šæœ¬

#### æ„å»ºè„šæœ¬
- **æ–‡ä»¶**: `build_docker.sh`
- **åŠŸèƒ½**: 
  - é€‰æ‹©ç¯å¢ƒï¼ˆæµ‹è¯•ç½‘/ç”Ÿäº§ï¼‰
  - æ„å»ºDockeré•œåƒ
  - æ˜¾ç¤ºæ„å»ºç»“æœ

#### ç”Ÿäº§éƒ¨ç½²è„šæœ¬
- **æ–‡ä»¶**: `deploy_prod.sh`
- **åŠŸèƒ½**:
  - ç¯å¢ƒå˜é‡æ£€æŸ¥
  - å¿…éœ€é…ç½®éªŒè¯
  - ç¡®è®¤éƒ¨ç½²æµç¨‹
  - å¥åº·çŠ¶æ€æ£€æŸ¥
  - éƒ¨ç½²åéªŒè¯

### 5. æ–‡æ¡£

#### éƒ¨ç½²æŒ‡å—
- **æ–‡ä»¶**: `docs/éƒ¨ç½²æŒ‡å—.md`
- **å†…å®¹**:
  - ç³»ç»Ÿè¦æ±‚
  - å¿«é€Ÿå¼€å§‹
  - æµ‹è¯•ç½‘éƒ¨ç½²
  - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
  - é…ç½®è¯´æ˜
  - å¸¸è§é—®é¢˜
  - ç›‘æ§å’Œç»´æŠ¤

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### æµ‹è¯•ç½‘éƒ¨ç½²
```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.testnet.example .env.testnet
nano .env.testnet

# 2. æ„å»ºé•œåƒ
./build_docker.sh

# 3. å¯åŠ¨æœåŠ¡
./start_testnet.sh

# 4. è®¿é—®ç³»ç»Ÿ
# å‰ç«¯: http://localhost:3000
# API: http://localhost:8000/docs
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.prod.example .env.prod
nano .env.prod

# 2. æ„å»ºé•œåƒ
./build_docker.sh

# 3. éƒ¨ç½²
./deploy_prod.sh

# 4. è®¿é—®ç³»ç»Ÿ
# å‰ç«¯: http://localhost
# API: http://localhost/api/docs
```

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx (80/443)             â”‚
â”‚         (åå‘ä»£ç† + è´Ÿè½½å‡è¡¡)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend    â”‚   â”‚  Backend   â”‚
    â”‚  (Next.js)    â”‚   â”‚ (FastAPI)  â”‚
    â”‚   Port 3000   â”‚   â”‚ Port 8000  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚PostgreSQLâ”‚      â”‚    Redis    â”‚     â”‚   Qdrant    â”‚
    â”‚Port 5432 â”‚      â”‚  Port 6379  â”‚     â”‚ Port 6333   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ
1. **ç”¨æˆ·è¯·æ±‚** â†’ Nginx â†’ Frontend/Backend
2. **APIè°ƒç”¨** â†’ Backend â†’ PostgreSQL/Redis/Qdrant
3. **å®æ—¶æ•°æ®** â†’ Backend â†’ Hyperliquid API â†’ Frontend
4. **AIå†³ç­–** â†’ Backend â†’ DeepSeek API â†’ Redisç¼“å­˜

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. å®Œæ•´DockeråŒ–
- âœ… åç«¯Dockeré•œåƒ
- âœ… å‰ç«¯Dockeré•œåƒ
- âœ… å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®

### 2. æœåŠ¡ç¼–æ’
- âœ… Docker Composeé…ç½®
- âœ… æœåŠ¡ä¾èµ–ç®¡ç†
- âœ… å¥åº·æ£€æŸ¥
- âœ… è‡ªåŠ¨é‡å¯

### 3. ç½‘ç»œé…ç½®
- âœ… Nginxåå‘ä»£ç†
- âœ… æœåŠ¡é—´é€šä¿¡
- âœ… ç«¯å£æ˜ å°„
- âœ… SSLæ”¯æŒï¼ˆå¯é€‰ï¼‰

### 4. æ•°æ®æŒä¹…åŒ–
- âœ… PostgreSQLæ•°æ®å·
- âœ… Redisæ•°æ®å·
- âœ… Qdrantæ•°æ®å·
- âœ… æ—¥å¿—æŒ‚è½½

### 5. éƒ¨ç½²è‡ªåŠ¨åŒ–
- âœ… ä¸€é”®æ„å»ºè„šæœ¬
- âœ… ä¸€é”®éƒ¨ç½²è„šæœ¬
- âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥
- âœ… å¥åº·çŠ¶æ€éªŒè¯

### 6. ç›‘æ§å’Œç»´æŠ¤
- âœ… æ—¥å¿—æŸ¥çœ‹å‘½ä»¤
- âœ… èµ„æºç›‘æ§
- âœ… æ•°æ®å¤‡ä»½æ–¹æ¡ˆ
- âœ… æ›´æ–°æµç¨‹

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–
- **å¤šWorker**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨4ä¸ªworker
- **è¿æ¥æ± **: PostgreSQLè¿æ¥æ± 
- **ç¼“å­˜**: Redisç¼“å­˜çƒ­æ•°æ®
- **å¼‚æ­¥IO**: FastAPIå¼‚æ­¥å¤„ç†

### å‰ç«¯ä¼˜åŒ–
- **å¤šé˜¶æ®µæ„å»º**: å‡å°é•œåƒä½“ç§¯
- **ç”Ÿäº§æ„å»º**: Next.jsä¼˜åŒ–
- **é™æ€èµ„æº**: Nginxç¼“å­˜
- **Gzipå‹ç¼©**: å‡å°‘ä¼ è¾“å¤§å°

### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•**: å…³é”®å­—æ®µç´¢å¼•
- **è¿æ¥æ± **: é™åˆ¶æœ€å¤§è¿æ¥æ•°
- **æŒä¹…åŒ–**: AOF + RDBæ··åˆæŒä¹…åŒ–

---

## ğŸ”’ å®‰å…¨æªæ–½

### 1. å¯†ç ä¿æŠ¤
- PostgreSQLå¯†ç 
- Rediså¯†ç 
- Secret Key

### 2. ç½‘ç»œéš”ç¦»
- Dockerç½‘ç»œéš”ç¦»
- ç«¯å£è®¿é—®æ§åˆ¶
- é˜²ç«å¢™è§„åˆ™

### 3. æ•°æ®å®‰å…¨
- å®šæœŸå¤‡ä»½
- æ•°æ®åŠ å¯†
- è®¿é—®æ—¥å¿—

### 4. SSL/TLS
- HTTPSæ”¯æŒ
- è¯ä¹¦é…ç½®
- å¼ºåŠ å¯†å¥—ä»¶

---

## ğŸ“ é…ç½®æ¸…å•

### å¿…éœ€é…ç½®
- âœ… DEEPSEEK_API_KEY
- âœ… HYPERLIQUID_WALLET_ADDRESS
- âœ… HYPERLIQUID_PRIVATE_KEY
- âœ… POSTGRES_PASSWORD
- âœ… REDIS_PASSWORD
- âœ… SECRET_KEY

### å¯é€‰é…ç½®
- âšª QWEN_API_KEY
- âšª GROK_API_KEY
- âšª CLAUDE_API_KEY
- âšª OPENAI_API_KEY
- âšª SSLè¯ä¹¦

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### å¼€å‘ç¯å¢ƒ
```bash
# ä½¿ç”¨docker-compose.testnet.yml
docker-compose -f docker-compose.testnet.yml up -d
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# ä½¿ç”¨æµ‹è¯•ç½‘é…ç½®
./start_testnet.sh
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®
./deploy_prod.sh
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### å¯åŠ¨æœåŠ¡
```bash
# æµ‹è¯•ç½‘
docker-compose -f docker-compose.testnet.yml up -d

# ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml up -d
```

### åœæ­¢æœåŠ¡
```bash
# æµ‹è¯•ç½‘
docker-compose -f docker-compose.testnet.yml down

# ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml down
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æ‰€æœ‰æœåŠ¡
docker-compose logs -f

# ç‰¹å®šæœåŠ¡
docker-compose logs -f backend
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥backendå®¹å™¨
docker exec -it aicoin-backend-prod-v2 bash

# è¿›å…¥PostgreSQL
docker exec -it aicoin-postgres-prod psql -U aicoin
```

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### ç³»ç»Ÿå¥åº·
- Backendå¥åº·: `curl http://localhost:8000/health`
- Frontendå¥åº·: `curl http://localhost:3000`
- Nginxå¥åº·: `curl http://localhost/health`

### èµ„æºä½¿ç”¨
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æº
docker stats

# æŸ¥çœ‹ç‰¹å®šå®¹å™¨
docker stats aicoin-backend-prod-v2
```

### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æ—¥å¿—
docker-compose logs -f backend | grep -E '(ğŸ”„|âœ…|âŒ|âš ï¸)'

# é”™è¯¯æ—¥å¿—
docker-compose logs backend | grep ERROR
```

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

### âœ… å·²å®Œæˆçš„å·¥ä½œ
1. âœ… åˆ›å»ºå®Œæ•´çš„Dockeré…ç½®
2. âœ… å®ç°å¤šç¯å¢ƒæ”¯æŒï¼ˆæµ‹è¯•ç½‘/ç”Ÿäº§ï¼‰
3. âœ… é…ç½®Nginxåå‘ä»£ç†
4. âœ… ç¼–å†™è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
5. âœ… å®Œå–„éƒ¨ç½²æ–‡æ¡£
6. âœ… å®ç°å¥åº·æ£€æŸ¥
7. âœ… é…ç½®æ•°æ®æŒä¹…åŒ–
8. âœ… ä¼˜åŒ–æ€§èƒ½å’Œå®‰å…¨

### ğŸš€ ä¸‹ä¸€æ­¥
1. æ ¹æ®éœ€è¦é…ç½®`.env.testnet`æˆ–`.env.prod`
2. è¿è¡Œ`./build_docker.sh`æ„å»ºé•œåƒ
3. è¿è¡Œ`./start_testnet.sh`æˆ–`./deploy_prod.sh`éƒ¨ç½²
4. è®¿é—®ç³»ç»Ÿå¹¶éªŒè¯åŠŸèƒ½
5. é…ç½®ç›‘æ§å’Œå‘Šè­¦ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [éƒ¨ç½²æŒ‡å—](docs/éƒ¨ç½²æŒ‡å—.md)
- [APIæ–‡æ¡£](http://localhost:8000/docs)
- [å‰ç«¯v2.0å‡çº§è®¡åˆ’](docs/å‰ç«¯v2.0å‡çº§è®¡åˆ’.md)
- [v2.0å®ç°æŠ¥å‘Š](docs/v2.0å®ç°æŠ¥å‘Š.md)

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2025-11-01 14:10  
**Dockerç‰ˆæœ¬**: 20.10+  
**Docker Composeç‰ˆæœ¬**: 2.0+  
**ç³»ç»ŸçŠ¶æ€**: âœ… å°±ç»ª

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸ³ğŸš€**

