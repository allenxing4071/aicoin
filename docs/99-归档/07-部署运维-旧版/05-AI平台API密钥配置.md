# API密钥配置指南

## 概述

AIcoin v3.1 引入了多云平台智能路由系统，需要配置多个API密钥以实现完整功能。

## 1. DeepSeek交易员配置

### 核心理念：智能混合使用

**重要说明**: 训练70B模型和默认API应该**智能混合使用**：
- **可以单独使用**: 某个模型明显更优时
- **可以同时使用**: 双模型投票（类似Qwen三平台验证）
- **智能自适应**: 系统根据实际效果动态选择

### 1.1 默认DeepSeek API（必需）

这是系统的保底方案，**必须配置**。

**获取步骤：**
1. 访问 https://platform.deepseek.com/
2. 注册/登录账号
3. 进入API管理页面
4. 创建新的API密钥
5. 复制密钥到配置文件

**配置项：**
```env
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx
DEEPSEEK_DEFAULT_API_KEY=sk-xxxxxxxxxxxxxxxx
DEEPSEEK_DEFAULT_BASE_URL=https://api.deepseek.com
```

### 1.2 训练好的70B模型（强烈推荐）

如果您在百度智能云部署了训练好的DeepSeek 70B模型：

**配置项：**
```env
DEEPSEEK_70B_API_KEY=your_baidu_api_key
DEEPSEEK_70B_BASE_URL=https://your-baidu-endpoint
DEEPSEEK_70B_AVAILABLE=true
```

**为什么强烈推荐？**
1. **启用双模型投票**: 两个模型互相验证（类似Qwen三平台验证）
2. **提升准确率**: 单模型~75% → 双模型投票85-90%
3. **降低风险**: 重要决策时的"双保险"
4. **智能自适应**: 系统会根据场景自动选择单用或同时用

**配置建议**:
- **不配置**: 系统使用默认API（也能正常工作）
- **配置后**: 解锁"双模型投票"等高级策略

## 2. Qwen情报员 - 三大云平台配置

### 2.1 百度智能云（推荐）

**获取步骤：**
1. 访问 https://cloud.baidu.com/
2. 注册/登录账号
3. 进入AI开发平台 → 千帆大模型平台
4. 创建应用并获取API Key
5. 选择Qwen模型（如：qwen-plus）

**配置项：**
```env
BAIDU_QWEN_API_KEY=your_baidu_api_key
BAIDU_QWEN_BASE_URL=https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop
ENABLE_BAIDU_QWEN=true
```

**价格：** 约 ¥0.012/千tokens（具体以百度官网为准）

### 2.2 腾讯云

**获取步骤：**
1. 访问 https://cloud.tencent.com/
2. 注册/登录账号
3. 进入腾讯混元大模型平台
4. 申请API访问权限
5. 获取SecretId和SecretKey

**配置项：**
```env
TENCENT_QWEN_API_KEY=your_tencent_api_key
TENCENT_QWEN_BASE_URL=https://hunyuan.tencentcloudapi.com
ENABLE_TENCENT_QWEN=true
```

### 2.3 火山引擎（字节跳动）

**获取步骤：**
1. 访问 https://www.volcengine.com/
2. 注册/登录账号
3. 进入火山方舟（模型服务平台）
4. 创建API访问凭证
5. 选择Qwen模型

**配置项：**
```env
VOLCANO_QWEN_API_KEY=your_volcano_api_key
VOLCANO_QWEN_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
ENABLE_VOLCANO_QWEN=true
```

### 2.4 AWS（国际化扩展）

**战略定位**：为全球化市场提供国际化信息源

**适用场景**：
- 需要英文市场信息
- 关注全球加密货币动态
- 跨时区交易需求
- 获取欧美监管信息

**配置项：**
```env
AWS_QWEN_API_KEY=your_aws_api_key
AWS_QWEN_BASE_URL=your_aws_endpoint
ENABLE_AWS_QWEN=true
```

**使用建议**：
- 中文市场为主：三大平台即可
- 全球化交易：建议添加AWS
- 可在管理后台的"情报平台"页面手动添加

## 3. 路由策略配置

### 3.1 DeepSeek路由策略（智能混合核心）

```env
# 路由策略（5种）
DEEPSEEK_ROUTING_STRATEGY=adaptive

# 策略说明：
# - adaptive: 自适应（推荐，系统自动选择最优策略）
#   * 样本不足 → AB测试（轮流用）
#   * 效果接近 → 双模型投票（同时用）
#   * 明显优劣 → 单模型（用更好的）
#   * 其他情况 → 场景分配（根据风险）
#
# - single_best: 单模型（选择综合得分最高的）
#   * 适用：某个模型明显更优时
#
# - ab_testing: AB测试（轮流使用，积累对比数据）
#   * 适用：初期积累性能数据
#
# - ensemble_voting: 双模型投票（同时调用，互相验证）⭐推荐
#   * 适用：重要决策、高风险场景
#   * 类似Qwen三平台验证思想
#   * 准确率可提升5-10%
#
# - scenario_based: 场景分配（根据风险等级选择）
#   * 高风险 → 准确率高的模型
#   * 低风险 → 速度快的模型

# 优先使用训练模型（如果可用）
DEEPSEEK_PREFER_TRAINED=true

# 自动降级到默认API（推荐开启）
DEEPSEEK_AUTO_FALLBACK=true
```

**智能混合说明**:
- 系统会根据实际效果动态调整使用策略
- 不是固定使用某一个模型
- 可以单独使用，也可以同时使用

### 3.2 性能评估配置

```env
# 性能评估窗口（天）
PERFORMANCE_WINDOW_DAYS=7

# 最少样本数（少于此数量时使用AB测试）
MIN_SAMPLES_FOR_EVALUATION=50
```

## 4. 配置验证

配置完成后，可通过以下方式验证：

### 4.1 检查API连通性

访问管理后台的"情报平台"页面，查看各平台的健康状态。

### 4.2 检查模型性能

访问管理后台的"模型性能"页面，查看：
- 训练70B模型和默认API的性能对比
- 当前使用的路由策略
- 系统推荐的策略

## 5. 成本预估

### 5.1 Qwen情报员（三平台同时使用）

**重要**：为了确保信息准确性，系统会同时调用三个平台进行交叉验证。

假设每天查询100次（每次查询调用3个平台）：
- 百度智能云：约 ¥1.2/天 × 100次 = ¥1.2/天
- 腾讯云：约 ¥1.5/天 × 100次 = ¥1.5/天
- 火山引擎：约 ¥1.3/天 × 100次 = ¥1.3/天

**标准配置总计：** 约 ¥4/天，¥120/月

**国际化配置（含AWS）：** 约 ¥5.5/天，¥165/月

**价值说明**：
- 虽然成本是单平台的3倍，但信息准确性大幅提升
- 避免因错误信息导致的交易损失（一次错误决策的损失可能远超月度API成本）
- 通过多源验证，置信度从单源的70%提升到90%+

### 5.2 DeepSeek交易员

假设每天决策100次：
- 默认API：约 $0.05/天
- 训练70B（如使用）：成本取决于百度部署方案

## 6. 最佳实践

### 6.1 强烈建议：三大云平台同时使用

**重要说明**：Qwen情报员的三大云平台应该**同时启用**，而不是单选。

**核心原因：**
1. **信息交叉验证**
   - 三个平台同时搜索同一主题
   - 系统会自动对比和验证信息
   - 过滤掉单一平台的不准确信息

2. **提升情报质量**
   - 多源信息汇总分析
   - 提取共同验证的可靠信息
   - 发现单一平台遗漏的关键信息

3. **降低误判风险**
   - 避免依赖单一信息源
   - 通过多平台共识提升置信度
   - 及时发现和排除虚假信息

### 6.2 AWS的战略价值

AWS平台虽然是预留，但对于全球化市场非常重要：
- **国际化视角**：获取全球市场的实时信息
- **英文信息源**：补充中文平台的不足
- **地域多样性**：覆盖不同时区和市场

### 6.3 完整配置建议

#### Qwen情报员配置

1. **标准配置（推荐）：** 百度 + 腾讯 + 火山 同时启用
2. **国际化配置：** 百度 + 腾讯 + 火山 + AWS 全部启用
3. **最低配置：** 至少启用两个平台（保证交叉验证）

#### DeepSeek交易员配置

1. **基础配置：** 只配置默认API
   - 准确率：~75%
   - 可正常使用

2. **推荐配置⭐：** 默认API + 训练70B模型
   - 解锁"双模型投票"功能
   - 准确率：85-90%
   - 类似Qwen的多平台验证思想

3. **最优策略：** 使用"自适应"路由
   - 系统自动选择单用或同时用
   - 兼顾准确性、速度、成本

#### 组合推荐

| 配置等级 | Qwen情报员 | DeepSeek交易员 | 综合效果 |
|---------|-----------|---------------|---------|
| 入门 | 2-3个平台 | 默认API | 基础可用 |
| **标准⭐** | **3个平台** | **默认API + 70B** | **推荐配置** |
| 国际化 | 4个平台 | 默认API + 70B | 全球覆盖 |
| 完整 | 4个平台 | 默认API + 70B | 最优效果 |

## 7. 故障排查

### 7.1 API调用失败

- 检查API密钥是否正确
- 检查网络连接
- 查看后台日志

### 7.2 路由器未工作

- 确认至少一个模型可用
- 检查性能数据是否积累足够
- 查看路由决策日志

### 7.3 成本异常

- 检查调用频率设置
- 查看各平台的调用统计
- 调整启用的平台数量

## 8. 安全建议

1. **不要公开API密钥**
2. 使用环境变量管理密钥
3. 定期轮换API密钥
4. 监控API调用量，防止滥用
5. 生产环境使用专用密钥

## 9. 技术支持

如有问题，请查看：
- 项目文档：`docs/AI多平台使用指南.md`
- 后台日志：`/var/log/aicoin/`
- GitHub Issues: [项目地址]

