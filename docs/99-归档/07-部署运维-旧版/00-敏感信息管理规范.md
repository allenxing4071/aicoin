# 敏感信息管理规范

## 📋 概述

本文档规定 AIcoin 项目中敏感信息的管理规范，确保密钥、密码等敏感数据的安全。

---

## 🔒 基本原则

### 1. 单一存储位置

**所有敏感信息必须存储在 `.env` 文件中，不得出现在其他地方。**

✅ **正确做法**：
```bash
# .env 文件
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxx
BINANCE_API_SECRET=xxxxxxxxxx
```

❌ **错误做法**：
```python
# 代码中硬编码
api_key = "sk-xxxxxxxxxxxxx"  # 禁止！

# 配置文件中
config.yaml:
  api_key: "sk-xxxxxxxxxxxxx"  # 禁止！

# 文档中
README.md:
  DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxx  # 禁止！
```

### 2. 文档中只使用占位符

文档中的所有示例必须使用占位符，不得包含真实密钥。

✅ **正确示例**：
```bash
# .env 配置示例
DEEPSEEK_API_KEY=your_deepseek_api_key_here
BINANCE_API_SECRET=your_binance_secret_here
TENCENT_SECRET_ID=your_tencent_secret_id
```

❌ **错误示例**：
```bash
# 不要在文档中写真实密钥！
DEEPSEEK_API_KEY=sk-abc123def456...  # 禁止！
```

### 3. Git 忽略规则

`.gitignore` 必须包含所有敏感文件：

```gitignore
# 环境变量文件
.env
.env.*.local
.env.local
.env.prod
.env.testnet

# API 密钥文件
**/api_keys.txt
**/private_key.txt
**/*_secret*.txt
**/*_key*.txt

# 配置文件
config.local.yaml
config.prod.yaml
```

---

## 📁 敏感信息类型

### 1. API 密钥

**位置**: `.env` 文件

```bash
# AI 平台
DEEPSEEK_API_KEY=your_key_here
QWEN_API_KEY=your_key_here
CLAUDE_API_KEY=your_key_here
OPENAI_API_KEY=your_key_here

# 交易所
BINANCE_API_KEY=your_key_here
BINANCE_API_SECRET=your_secret_here
HYPERLIQUID_PRIVATE_KEY=your_key_here

# 云服务
TENCENT_SECRET_ID=your_id_here
TENCENT_SECRET_KEY=your_key_here
AWS_ACCESS_KEY=your_key_here
AWS_SECRET_KEY=your_key_here
```

### 2. 数据库密码

**位置**: `.env` 文件

```bash
DATABASE_URL=postgresql://user:password@localhost:5433/dbname
REDIS_URL=redis://localhost:6379
```

### 3. 应用密钥

**位置**: `.env` 文件

```bash
JWT_SECRET_KEY=your-jwt-secret-key
SECRET_KEY=your-app-secret-key
```

### 4. 钱包私钥

**位置**: `.env` 文件

```bash
HYPERLIQUID_PRIVATE_KEY=your_private_key
HYPERLIQUID_WALLET_ADDRESS=your_wallet_address
```

---

## 📝 文档编写规范

### 1. 使用 .env.example

项目根目录的 `.env.example` 是配置模板：

```bash
# 复制模板
cp .env.example .env

# 编辑 .env 填入真实密钥
vim .env
```

### 2. 文档中的示例格式

**标准占位符格式**：

```bash
# 格式：your_{service}_{type}_here
DEEPSEEK_API_KEY=your_deepseek_api_key_here
BINANCE_API_SECRET=your_binance_api_secret_here
TENCENT_SECRET_ID=your_tencent_secret_id_here

# 或使用 xxx 占位符
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx
BINANCE_API_SECRET=xxxxxxxxxxxxxxxx
```

### 3. 文档中的安全提示

每个涉及密钥配置的文档都应包含安全提示：

```markdown
⚠️ **安全提示**：
- 不要将 .env 文件提交到 Git
- 不要在文档中包含真实密钥
- 定期轮换密钥
- 使用强密码
```

---

## 🛡️ 安全检查清单

### 提交代码前检查

- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 代码中没有硬编码的密钥
- [ ] 配置文件中没有真实密钥
- [ ] 文档中只有占位符示例
- [ ] 测试文件中没有真实密钥
- [ ] 日志中不会输出敏感信息

### 定期安全审计

```bash
# 检查是否有敏感信息泄露
git diff | grep -i "api_key\|password\|secret\|token"

# 检查文档中的密钥
grep -r "AKID\|sk-\|api_key.*=" docs/ --include="*.md"

# 检查代码中的硬编码
grep -r "api_key\s*=\s*['\"]" . --include="*.py" --include="*.ts"
```

---

## 🔄 密钥轮换流程

### 1. 定期轮换

建议每 3-6 个月轮换一次密钥。

### 2. 轮换步骤

```bash
# 1. 在服务提供商处生成新密钥
# 2. 更新 .env 文件
vim .env

# 3. 重启服务
docker compose restart

# 4. 验证新密钥工作正常
# 5. 在服务提供商处删除旧密钥
```

### 3. 紧急轮换

如果密钥泄露：

1. **立即**在服务提供商处删除泄露的密钥
2. 生成新密钥
3. 更新 `.env` 文件
4. 重启所有服务
5. 检查是否有未授权访问
6. 如果密钥已提交到 Git，使用 `git filter-branch` 清理历史

---

## 📚 相关工具

### 1. 环境变量管理

```bash
# 使用 dotenv 加载环境变量
from dotenv import load_dotenv
load_dotenv()

# 读取环境变量
import os
api_key = os.getenv('DEEPSEEK_API_KEY')
```

### 2. 密钥加密存储

对于需要持久化的密钥（如用户的交易所 API 密钥）：

```python
from cryptography.fernet import Fernet

# 生成密钥
key = Fernet.generate_key()
cipher = Fernet(key)

# 加密
encrypted = cipher.encrypt(api_key.encode())

# 解密
decrypted = cipher.decrypt(encrypted).decode()
```

### 3. Git 历史清理

如果不小心提交了敏感信息：

```bash
# 使用 git filter-branch 删除文件
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch path/to/sensitive/file" \
  --prune-empty --tag-name-filter cat -- --all

# 强制推送
git push origin --force --all
```

---

## ⚠️ 常见错误

### 1. 在文档中写真实密钥

❌ **错误**：
```markdown
## 配置示例
DEEPSEEK_API_KEY=sk-abc123def456ghi789
```

✅ **正确**：
```markdown
## 配置示例
DEEPSEEK_API_KEY=your_deepseek_api_key_here
```

### 2. 在代码中硬编码

❌ **错误**：
```python
api_key = "sk-abc123def456"
```

✅ **正确**：
```python
import os
api_key = os.getenv('DEEPSEEK_API_KEY')
```

### 3. 在日志中输出密钥

❌ **错误**：
```python
logger.info(f"Using API key: {api_key}")
```

✅ **正确**：
```python
logger.info(f"Using API key: {api_key[:8]}...")
```

### 4. 提交 .env 文件

❌ **错误**：
```bash
git add .env
git commit -m "add config"
```

✅ **正确**：
```bash
# .env 应该在 .gitignore 中
# 只提交 .env.example
git add .env.example
git commit -m "add config template"
```

---

## 📞 应急响应

### 密钥泄露处理流程

1. **立即行动**（5分钟内）
   - 在服务提供商处删除泄露的密钥
   - 生成新密钥
   - 更新系统配置

2. **影响评估**（30分钟内）
   - 检查访问日志
   - 确认是否有未授权访问
   - 评估潜在损失

3. **清理和恢复**（1小时内）
   - 从 Git 历史中删除敏感信息
   - 更新所有相关文档
   - 通知相关人员

4. **事后分析**（24小时内）
   - 分析泄露原因
   - 更新安全流程
   - 加强培训

---

## ✅ 最佳实践

1. **永远不要**在代码、文档、配置文件中硬编码密钥
2. **始终使用** `.env` 文件存储敏感信息
3. **确保** `.env` 在 `.gitignore` 中
4. **提供** `.env.example` 作为配置模板
5. **定期轮换**所有密钥
6. **使用加密**存储用户的敏感信息
7. **限制访问**只有必要的人员才能访问密钥
8. **监控使用**定期检查 API 使用情况
9. **备份密钥**在安全的地方（如密码管理器）
10. **培训团队**确保所有人了解安全规范

---

## 📖 相关文档

- [部署指南](./01-部署指南.md)
- [环境变量配置](../../.env.example)
- [Git 使用规范](../99-归档/GIT_COMMIT_V3.0.md)

---

*最后更新: 2025-11-10*  
*版本: v1.0*  
*状态: ✅ 强制执行*

