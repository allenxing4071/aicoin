# v3.1 æµ‹è¯•éªŒè¯è®¡åˆ’

> **æ—¥æœŸ**: 2025-11-05  
> **ç‰ˆæœ¬**: v3.1.0  
> **çŠ¶æ€**: å‡†å¤‡æµ‹è¯•

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### ç¯å¢ƒæ£€æŸ¥ç»“æœ

âœ… **Pythonç¯å¢ƒ**
- Python 3.13.1 å·²å®‰è£…
- Alembic 1.16.5 å·²å®‰è£…

âœ… **æ•°æ®åº“æœåŠ¡**
- PostgreSQL 15 è¿è¡Œåœ¨ Docker (ç«¯å£5433)
- å®¹å™¨å: aicoin-postgres
- çŠ¶æ€: healthy

âš ï¸ **æ•°æ®åº“è¿æ¥é…ç½®**
- éœ€è¦ç¡®è®¤ `.env` ä¸­çš„ `DATABASE_URL` é…ç½®
- ç¤ºä¾‹: `postgresql://admin:password@localhost:5433/aicoin`

---

## ğŸ§ª æµ‹è¯•é˜¶æ®µåˆ’åˆ†

### Phase 1: æ•°æ®åº“è¿ç§»æµ‹è¯• (é«˜ä¼˜å…ˆçº§)

#### 1.1 è¿ç§»æ–‡ä»¶éªŒè¯
```bash
# æ£€æŸ¥è¿ç§»æ–‡ä»¶è¯­æ³•
cd /Users/xinghailong/Documents/soft/AIcoin/backend
python3 -c "import sys; sys.path.insert(0, '.'); from alembic.versions import *"
```

#### 1.2 æŸ¥çœ‹è¿ç§»å†å²
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
python3 -m alembic current

# æŸ¥çœ‹è¿ç§»å†å²
python3 -m alembic history

# æŸ¥çœ‹ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„è¿ç§»
python3 -m alembic heads
```

#### 1.3 æ‰§è¡Œè¿ç§» (éœ€è¦æ­£ç¡®çš„æ•°æ®åº“è¿æ¥)
```bash
# å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
python3 -m alembic upgrade head

# éªŒè¯è¿ç§»ç»“æœ
psql -h localhost -p 5433 -U admin -d aicoin -c "\dt"
psql -h localhost -p 5433 -U admin -d aicoin -c "\d exchange_configs"
psql -h localhost -p 5433 -U admin -d aicoin -c "\d market_data_kline"
```

**é¢„æœŸç»“æœ**:
- âœ… æ–°å¢ `exchange_configs` è¡¨
- âœ… `market_data_kline` è¡¨æ–°å¢å­—æ®µ: `exchange`, `market_type`, `funding_rate`, `open_interest`
- âœ… æ–°å¢å”¯ä¸€çº¦æŸå’Œç´¢å¼•

---

### Phase 2: åç«¯APIæµ‹è¯• (é«˜ä¼˜å…ˆçº§)

#### 2.1 å¯åŠ¨åç«¯æœåŠ¡å™¨
```bash
cd /Users/xinghailong/Documents/soft/AIcoin/backend
python3 -m uvicorn app.main:app --reload --port 8000
```

**æ£€æŸ¥ç‚¹**:
- [ ] æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- [ ] æ— å¯¼å…¥é”™è¯¯
- [ ] æ— é…ç½®é”™è¯¯
- [ ] æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸

#### 2.2 è®¿é—®APIæ–‡æ¡£
```bash
# åœ¨æµè§ˆå™¨æ‰“å¼€
open http://localhost:8000/docs
```

**éªŒè¯å†…å®¹**:
- [ ] `/api/v1/exchanges` ç«¯ç‚¹ç»„å­˜åœ¨
- [ ] `/api/v1/market/klines/multi` ç«¯ç‚¹å­˜åœ¨
- [ ] `/api/v1/market/spot-futures-compare` ç«¯ç‚¹å­˜åœ¨

#### 2.3 æµ‹è¯•äº¤æ˜“æ‰€ç®¡ç†API

**è·å–äº¤æ˜“æ‰€åˆ—è¡¨**
```bash
curl -X GET http://localhost:8000/api/v1/exchanges \
  -H "Content-Type: application/json" | jq
```

**è·å–å½“å‰æ¿€æ´»çš„äº¤æ˜“æ‰€**
```bash
curl -X GET http://localhost:8000/api/v1/exchanges/active \
  -H "Content-Type: application/json" | jq
```

**åˆ‡æ¢äº¤æ˜“æ‰€åˆ°Hyperliquid**
```bash
curl -X POST http://localhost:8000/api/v1/exchanges/switch \
  -H "Content-Type: application/json" \
  -d '{
    "exchange_name": "hyperliquid",
    "market_type": "perpetual"
  }' | jq
```

**é¢„æœŸç»“æœ**:
- âœ… è¿”å›200çŠ¶æ€ç 
- âœ… JSONå“åº”æ ¼å¼æ­£ç¡®
- âœ… æ•°æ®ç»“æ„ç¬¦åˆé¢„æœŸ

#### 2.4 æµ‹è¯•å¤šå‘¨æœŸKçº¿API

**è·å–BTCå¤šå‘¨æœŸKçº¿**
```bash
curl -X GET "http://localhost:8000/api/v1/market/klines/multi?symbol=BTC&market_type=perpetual&limit=100" \
  -H "Content-Type: application/json" | jq
```

**é¢„æœŸå“åº”**:
```json
{
  "symbol": "BTC",
  "market_type": "perpetual",
  "exchange": "hyperliquid",
  "timeframes": {
    "1m": [...],
    "5m": [...],
    "15m": [...],
    "1h": [...],
    "4h": [...],
    "1d": [...]
  }
}
```

---

### Phase 3: å‰ç«¯UIæµ‹è¯• (ä¸­ä¼˜å…ˆçº§)

#### 3.1 å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```bash
cd /Users/xinghailong/Documents/soft/AIcoin/frontend
npm run dev
```

**æ£€æŸ¥ç‚¹**:
- [ ] æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨(ç«¯å£3000)
- [ ] æ— ç¼–è¯‘é”™è¯¯
- [ ] æ— TypeScripté”™è¯¯

#### 3.2 æµ‹è¯•Adminå¯¼èˆªèœå•
```bash
# è®¿é—®Adminé¡µé¢
open http://localhost:3000/admin
```

**éªŒè¯å†…å®¹**:
- [ ] "äº¤æ˜“æ‰€ç®¡ç†" èœå•é¡¹æ˜¾ç¤º
- [ ] "æƒ…æŠ¥ç³»ç»Ÿ" èœå•é¡¹æ˜¾ç¤º
- [ ] ç‚¹å‡»å¯¼èˆªæ­£å¸¸è·³è½¬

#### 3.3 æµ‹è¯•äº¤æ˜“æ‰€ç®¡ç†é¡µé¢
```bash
# ç›´æ¥è®¿é—®äº¤æ˜“æ‰€ç®¡ç†é¡µé¢
open http://localhost:3000/admin/exchanges
```

**éªŒè¯å†…å®¹**:
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] äº¤æ˜“æ‰€åˆ—è¡¨æ˜¾ç¤º
- [ ] åˆ‡æ¢æŒ‰é’®å¯ç”¨
- [ ] é…ç½®è¡¨å•æ­£å¸¸æ˜¾ç¤º

#### 3.4 æµ‹è¯•ExchangeSelectorç»„ä»¶
**åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•**:
```javascript
// æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
document.querySelector('[data-component="exchange-selector"]')
```

#### 3.5 æµ‹è¯•MultiTimeframeChartç»„ä»¶
**éªŒè¯å†…å®¹**:
- [ ] å›¾è¡¨å®¹å™¨æ­£å¸¸æ¸²æŸ“
- [ ] å¤šä¸ªæ—¶é—´æ¡†æ¶tabæ˜¾ç¤º
- [ ] Kçº¿æ•°æ®æ­£ç¡®åŠ è½½
- [ ] å›¾è¡¨äº¤äº’æ­£å¸¸

---

### Phase 4: é›†æˆæµ‹è¯• (ä¸­ä¼˜å…ˆçº§)

#### 4.1 ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹

**åœºæ™¯1: åˆ‡æ¢äº¤æ˜“æ‰€**
1. åœ¨Adminé¡µé¢æ‰“å¼€äº¤æ˜“æ‰€ç®¡ç†
2. ç‚¹å‡»åˆ‡æ¢åˆ°Binance
3. éªŒè¯å‰ç«¯çŠ¶æ€æ›´æ–°
4. éªŒè¯åç«¯APIå“åº”
5. æ£€æŸ¥æ•°æ®åº“è®°å½•

**åœºæ™¯2: è·å–å¤šå‘¨æœŸKçº¿**
1. é€‰æ‹©äº¤æ˜“å“ç§(BTC)
2. è¯·æ±‚å¤šå‘¨æœŸKçº¿æ•°æ®
3. éªŒè¯æ•°æ®æ­£ç¡®æ€§
4. æ£€æŸ¥å„æ—¶é—´æ¡†æ¶æ•°æ®å®Œæ•´æ€§

**åœºæ™¯3: ç°è´§åˆçº¦å¯¹æ¯”**
1. é€‰æ‹©å¸å®‰ç°è´§
2. é€‰æ‹©å¸å®‰åˆçº¦
3. è·å–å¯¹æ¯”æ•°æ®
4. éªŒè¯ä»·å·®è®¡ç®—æ­£ç¡®

---

### Phase 5: æ€§èƒ½æµ‹è¯• (ä½ä¼˜å…ˆçº§)

#### 5.1 APIå“åº”æ—¶é—´æµ‹è¯•
```bash
# æµ‹è¯•äº¤æ˜“æ‰€åˆ—è¡¨API
time curl -X GET http://localhost:8000/api/v1/exchanges

# æµ‹è¯•å¤šå‘¨æœŸKçº¿API
time curl -X GET "http://localhost:8000/api/v1/market/klines/multi?symbol=BTC&market_type=perpetual&limit=100"
```

**æ€§èƒ½æŒ‡æ ‡**:
- äº¤æ˜“æ‰€åˆ—è¡¨: < 100ms
- å¤šå‘¨æœŸKçº¿: < 2000ms

#### 5.2 å¹¶å‘æµ‹è¯•
```bash
# ä½¿ç”¨Apache Benchæµ‹è¯•
ab -n 100 -c 10 http://localhost:8000/api/v1/exchanges/active
```

---

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

### æ•°æ®åº“æµ‹è¯•
- [ ] è¿ç§»æ–‡ä»¶è¯­æ³•æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] è¿ç§»æ‰§è¡ŒæˆåŠŸ
- [ ] è¡¨ç»“æ„æ­£ç¡®åˆ›å»º
- [ ] çº¦æŸå’Œç´¢å¼•æ­£ç¡®

### åç«¯APIæµ‹è¯•
- [ ] æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- [ ] APIè·¯ç”±æ­£ç¡®æ³¨å†Œ
- [ ] äº¤æ˜“æ‰€ç®¡ç†APIæ­£å¸¸
- [ ] å¤šå‘¨æœŸKçº¿APIæ­£å¸¸
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸

### å‰ç«¯UIæµ‹è¯•
- [ ] å‰ç«¯æ­£å¸¸å¯åŠ¨
- [ ] Adminå¯¼èˆªèœå•æ­£ç¡®
- [ ] äº¤æ˜“æ‰€ç®¡ç†é¡µé¢æ­£å¸¸
- [ ] ExchangeSelectorç»„ä»¶æ­£å¸¸
- [ ] MultiTimeframeChartç»„ä»¶æ­£å¸¸
- [ ] ç”¨æˆ·äº¤äº’æµç•…

### é›†æˆæµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµç¨‹æ­£å¸¸
- [ ] å‰åç«¯é€šä¿¡æ­£å¸¸
- [ ] æ•°æ®ä¸€è‡´æ€§æ­£ç¡®
- [ ] çŠ¶æ€åŒæ­¥æ­£ç¡®

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥
**é”™è¯¯**: `could not translate host name "postgres" to address`

**åŸå› **: DATABASE_URLé…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åœ¨.envæ–‡ä»¶ä¸­ç¡®è®¤é…ç½®
DATABASE_URL=postgresql://admin:password@localhost:5433/aicoin
```

### é—®é¢˜2: APIè·¯ç”±404
**åŸå› **: è·¯ç”±æœªæ­£ç¡®æ³¨å†Œ

**è§£å†³æ–¹æ¡ˆ**: âœ… å·²åœ¨v3.1_è‡ªæ£€ä¸­ä¿®å¤

### é—®é¢˜3: å‰ç«¯å¯¼èˆªèœå•ç¼ºå¤±
**åŸå› **: navItemsæœªæ·»åŠ æ–°èœå•

**è§£å†³æ–¹æ¡ˆ**: âœ… å·²åœ¨v3.1_è‡ªæ£€ä¸­ä¿®å¤

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•æ‰§è¡Œè®°å½•

| æµ‹è¯•é¡¹ | çŠ¶æ€ | æ‰§è¡Œæ—¶é—´ | å¤‡æ³¨ |
|--------|------|----------|------|
| æ•°æ®åº“è¿ç§» | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| APIå¯åŠ¨ | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| äº¤æ˜“æ‰€API | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| Kçº¿API | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| å‰ç«¯å¯åŠ¨ | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| Adminé¡µé¢ | â³ | - | ç­‰å¾…æ‰§è¡Œ |
| ç»„ä»¶æµ‹è¯• | â³ | - | ç­‰å¾…æ‰§è¡Œ |

### é—®é¢˜è®°å½•

| é—®é¢˜æè¿° | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|----------|----------|------|----------|
| - | - | - | - |

---

## ğŸ¯ æµ‹è¯•ä¼˜å…ˆçº§

### P0 - é˜»å¡æ€§é—®é¢˜(å¿…é¡»è§£å†³)
1. æ•°æ®åº“è¿ç§»æ‰§è¡Œ
2. APIæœåŠ¡å™¨å¯åŠ¨
3. APIè·¯ç”±å¯è®¿é—®

### P1 - å…³é”®åŠŸèƒ½(åº”è¯¥è§£å†³)
1. äº¤æ˜“æ‰€åˆ‡æ¢API
2. å¤šå‘¨æœŸKçº¿API
3. Adminé¡µé¢æ˜¾ç¤º

### P2 - ä¸€èˆ¬åŠŸèƒ½(å¯ä»¥å»¶å)
1. å‰ç«¯ç»„ä»¶ç»†èŠ‚
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. âœ… æ£€æŸ¥Docker PostgreSQLçŠ¶æ€
2. â³ ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®
3. â³ æ‰§è¡Œæ•°æ®åº“è¿ç§»
4. â³ å¯åŠ¨åç«¯æœåŠ¡å™¨
5. â³ æµ‹è¯•APIç«¯ç‚¹

### çŸ­æœŸè®¡åˆ’
1. å®Œæˆæ‰€æœ‰P0æµ‹è¯•
2. å®Œæˆæ‰€æœ‰P1æµ‹è¯•
3. è®°å½•æµ‹è¯•ç»“æœ
4. ä¿®å¤å‘ç°çš„é—®é¢˜

### ä¸­æœŸè®¡åˆ’
1. å®ŒæˆP2æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. æ–‡æ¡£æ›´æ–°
4. ç”¨æˆ·åŸ¹è®­

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-05 20:45  
**æµ‹è¯•è´Ÿè´£äºº**: äº§å“ç»ç† + AI Assistant  
**é¢„è®¡å®Œæˆæ—¶é—´**: 2025-11-06

