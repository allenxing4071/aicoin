# 安全架构设计

**文档编号**: AICOIN-ARCH-004  
**文档版本**: v1.0.0  
**文档状态**: ✅ 已批准  
**创建日期**: 2025-10-22  
**最后更新**: 2025-10-22  
**文档所有者**: 技术负责人  
**密级**: 内部机密

---

## 1. 私钥管理

### 1.1 开发环境
```
环境变量 (.env)
PRIVATE_KEY=0x...
禁止提交到Git
```

### 1.2 生产环境
```
硬件钱包 (Ledger/Trezor)
或
AWS Secrets Manager
加密存储: AES-256
```

---

## 2. 身份认证

### 2.1 JWT Token
```python
from fastapi import Depends, HTTPException
from jose import JWTError, jwt

SECRET_KEY = "your-secret-key"
ALGORITHM = "HS256"

def get_current_user(token: str = Depends(oauth2_scheme)):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload
    except JWTError:
        raise HTTPException(status_code=401)
```

---

## 3. API安全

### 3.1 速率限制
- 100请求/分钟/IP
- 使用Redis存储计数器

### 3.2 CORS
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://aicoin.ai"],
    allow_methods=["GET", "POST"],
)
```

---

## 4. 数据加密

### 4.1 传输加密
- HTTPS强制（Let's Encrypt）
- TLS 1.3

### 4.2 存储加密
```python
from cryptography.fernet import Fernet

def encrypt_api_key(api_key: str):
    f = Fernet(SECRET_KEY)
    return f.encrypt(api_key.encode())
```

---

## 5. 审计日志

```sql
CREATE TABLE audit_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    action VARCHAR(100),
    resource VARCHAR(100),
    ip_address INET,
    timestamp TIMESTAMP DEFAULT NOW()
);
```

---

**文档结束**

