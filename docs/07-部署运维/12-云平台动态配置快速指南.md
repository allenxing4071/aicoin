# 云平台动态配置快速指南

> **版本**: v2.0  
> **更新时间**: 2025-11-07  
> **适用场景**: 动态管理AI云平台配置，无需重启服务

---

## 🎯 核心特性

### ✨ 主要优势

- **🔄 动态加载**：配置更改即时生效
- **🚀 无需重启**：在线管理，零停机时间
- **💾 数据库优先**：配置持久化存储
- **🔙 环境变量兼容**：支持传统配置方式
- **🎨 可视化管理**：通过管理后台操作

---

## 📋 快速开始

### 步骤1：访问管理后台

```
路径：管理后台 → 情报中心 → 情报源配置 → 云平台管理
```

### 步骤2：添加云平台

点击"➕ 添加平台"按钮，填写以下信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **平台名称** | 自定义名称 | `Qwen主平台` |
| **服务商** | 选择云服务商 | `qwen` / `tencent` / `volcano` |
| **平台类型** | 平台功能类型 | `Qwen Search (搜索增强)` |
| **Base URL** | API基础地址 | `https://dashscope.aliyuncs.com/compatible-mode/v1` |
| **API Key** | API密钥 | `sk-xxx...` |

### 步骤3：重新加载配置

- **自动重新加载**：添加平台后自动触发
- **手动重新加载**：点击"🔄 重新加载"按钮

### 步骤4：验证配置

1. **查看平台列表**：确认平台已显示
2. **查看数据源状态**：顶部"数据源状态概览"卡片
3. **查看后端日志**：确认平台加载成功

---

## 🔧 配置示例

### 示例1：配置Qwen主平台

```
平台名称：Qwen主平台
服务商：qwen
平台类型：Qwen Search (搜索增强)
Base URL：https://dashscope.aliyuncs.com/compatible-mode/v1
API Key：sk-cfe26fffcd564dab9e6fea61481551d1
启用：✅
```

### 示例2：配置腾讯混元

```
平台名称：腾讯混元
服务商：tencent
平台类型：Qwen Search (搜索增强)
Base URL：https://api.hunyuan.cloud.tencent.com/v1
API Key：sk-gZBvxB0BBLI7jJY0xVGiog0CL79I0I5geloXj1G1dXpQ1hOB
启用：✅
```

### 示例3：配置火山引擎

```
平台名称：火山引擎
服务商：volcano
平台类型：Qwen Search (搜索增强)
Base URL：https://ark.cn-beijing.volces.com/api/v3
API Key：1017616e-0338-429e-9e37-f3c9e6187af3
启用：✅
```

---

## 🔄 配置更新流程

### 完整流程图

```
┌─────────────────────┐
│  1. 在管理后台      │
│     添加/修改平台   │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  2. 保存到数据库    │
│     (自动)          │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  3. 触发重新加载    │
│     (自动/手动)     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  4. 从数据库加载    │
│     新配置          │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  5. 配置立即生效    │
│     (无需重启)      │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  6. 下次情报收集    │
│     使用新配置      │
└─────────────────────┘
```

### 时间线

- **添加平台**：< 1秒
- **保存数据库**：< 1秒
- **重新加载**：1-3秒
- **配置生效**：立即
- **总耗时**：< 5秒

---

## 🎨 UI界面说明

### 1. 数据源状态概览

显示所有数据源的配置状态：

- **📰 RSS新闻源**：已启用的RSS源数量
- **🐋 巨鲸监控**：Whale Alert API配置状态
- **⛓️ 链上数据**：Etherscan/Glassnode配置状态
- **🌐 数据模式**：真实数据 / 模拟数据

### 2. 云平台管理说明

黄色说明框，包含：

- **🔄 工作原理**：多云平台并行分析架构
- **📊 数据流程**：4步流程说明
- **⚙️ 配置要求**：推荐配置和最低配置
- **⚠️ 重要提示**：注意事项

### 3. 云平台列表

每个平台卡片显示：

- **平台图标**：🟪 🟩 🟧 等
- **平台名称**：自定义名称
- **启用状态**：启用 / 禁用
- **平台类型**：Qwen Search / Qwen Deep / 免费API
- **性能指标**：调用次数、成功率、响应时间
- **Base URL**：API地址
- **操作按钮**：启用 / 停用

---

## 🔍 故障排查

### 问题1：重新加载失败

**症状**：点击"重新加载"按钮后提示失败

**原因**：
- 后端服务未启动
- 数据库连接失败
- 协调器未初始化

**解决方案**：
1. 检查后端服务是否运行
2. 查看后端日志错误信息
3. 重启后端服务

### 问题2：平台未加载

**症状**：添加平台后，后端日志没有加载信息

**原因**：
- 平台被禁用
- API Key无效
- Base URL错误

**解决方案**：
1. 确认平台已启用
2. 验证API Key有效性
3. 检查Base URL格式
4. 点击"重新加载"按钮

### 问题3：配置不生效

**症状**：重新加载成功，但情报收集仍使用旧配置

**原因**：
- 情报收集任务未重新启动
- 缓存未清除

**解决方案**：
1. 等待下一次定时任务（30分钟）
2. 或手动触发情报收集
3. 或重启后端服务

---

## 🛠️ API参考

### 列出所有平台

```http
GET /api/v1/intelligence/platforms
```

**响应**：
```json
{
  "platforms": [
    {
      "id": 1,
      "name": "Qwen主平台",
      "provider": "qwen",
      "platform_type": "qwen_search",
      "enabled": true,
      "base_url": "https://...",
      "performance": {
        "total_calls": 0,
        "success_rate": 0.0,
        "avg_response_time": null,
        "total_cost": 0.0
      }
    }
  ],
  "total": 1
}
```

### 添加平台

```http
POST /api/v1/intelligence/platforms
Content-Type: application/json

{
  "name": "Qwen主平台",
  "provider": "qwen",
  "platform_type": "qwen_search",
  "api_key": "sk-xxx...",
  "base_url": "https://...",
  "enabled": true
}
```

### 重新加载配置

```http
POST /api/v1/intelligence/platforms/reload
```

**响应**：
```json
{
  "success": true,
  "message": "平台配置已重新加载，共 3 个平台",
  "platforms_loaded": 3,
  "timestamp": "2025-11-07T10:00:00"
}
```

### 更新平台

```http
PATCH /api/v1/intelligence/platforms/{platform_id}
Content-Type: application/json

{
  "enabled": false
}
```

---

## 💡 最佳实践

### 1. 平台配置

- **推荐配置**：至少3个云平台（准确率85%+）
- **最低配置**：1个云平台（准确率70%）
- **测试环境**：先在测试环境验证API Key

### 2. 成本控制

- 监控各平台调用次数
- 设置合理的更新频率
- 禁用不需要的平台

### 3. 高可用

- 配置多个云平台（故障转移）
- 定期检查平台健康状态
- 保留环境变量配置作为备份

### 4. 安全性

- 不要在前端显示完整API Key
- 定期更换API Key
- 使用HTTPS传输

---

## 📊 性能指标

### 加载性能

| 操作 | 耗时 | 说明 |
|------|------|------|
| 数据库查询 | < 100ms | 查询平台配置 |
| 创建适配器 | < 50ms | 每个平台 |
| 总加载时间 | < 1s | 3个平台 |

### 重新加载影响

- **对用户**：无感知（后台操作）
- **对服务**：无中断（继续运行）
- **对性能**：可忽略（< 1s）

---

## 🔗 相关文档

- [系统运行逻辑问题分析](./11-系统运行逻辑问题分析.md)
- [情报平台详细配置指南](./08-情报平台详细配置指南.md)
- [云平台配置快速参考表](./09-云平台配置快速参考表.md)

---

## 📞 技术支持

如遇问题，请提供：

1. **操作步骤**：详细描述操作过程
2. **错误信息**：截图或文字描述
3. **后端日志**：最近100行日志
4. **平台配置**：隐藏敏感信息的配置截图

---

**文档版本**: v2.0  
**创建时间**: 2025-11-07  
**最后更新**: 2025-11-07  
**维护者**: AIcoin开发团队

