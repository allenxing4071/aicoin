# æœåŠ¡å™¨è¿æ¥é…ç½®æ¨¡æ¿

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æœåŠ¡å™¨ SSH è¿æ¥é…ç½®çš„æ ‡å‡†æ¨¡æ¿ã€‚**è¯·å‹¿åœ¨æ­¤æ–‡æ¡£ä¸­å¡«å†™çœŸå®çš„è¿æ¥ä¿¡æ¯ã€‚**

çœŸå®çš„è¿æ¥ä¿¡æ¯åº”å­˜æ”¾åœ¨ï¼š`docs/07-éƒ¨ç½²è¿ç»´/ç§å¯†é…ç½®/` ç›®å½•ï¼ˆè¯¥ç›®å½•å·²è¢« `.gitignore` æ’é™¤ï¼‰

---

## ğŸ”‘ SSH å¯†é’¥è¿æ¥é…ç½®

### 1. æœåŠ¡å™¨ä¿¡æ¯æ¨¡æ¿

```
================================================================================
                        æœåŠ¡å™¨è¿æ¥ä¿¡æ¯
================================================================================

IP åœ°å€: your_server_ip_here
ç”¨æˆ·å: your_username_here
ç§é’¥æ–‡ä»¶: ~/.ssh/your-server-key.pem
SSH ç«¯å£: 22

================================================================================
å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤
================================================================================

ssh -i ~/.ssh/your-server-key.pem your_username@your_server_ip

================================================================================
å¿«é€Ÿé…ç½®ï¼ˆ3æ­¥ï¼‰
================================================================================

1. æ‹·è´ç§é’¥æ–‡ä»¶åˆ°å®¢æˆ·ç«¯ç”µè„‘çš„ ~/.ssh/ ç›®å½•
2. è®¾ç½®æƒé™: chmod 600 ~/.ssh/your-server-key.pem
3. è¿æ¥: ssh -i ~/.ssh/your-server-key.pem your_username@your_server_ip

================================================================================
```

### 2. SSH Config é…ç½®æ¨¡æ¿

åˆ›å»ºæˆ–ç¼–è¾‘ `~/.ssh/config` æ–‡ä»¶ï¼š

```bash
Host your-server-alias
    HostName your_server_ip
    User your_username
    Port 22
    IdentityFile ~/.ssh/your-server-key.pem
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

è®¾ç½®æ­£ç¡®çš„æƒé™ï¼š

```bash
chmod 600 ~/.ssh/config
```

é…ç½®åå¯ä»¥ç®€åŒ–è¿æ¥ï¼š

```bash
ssh your-server-alias
```

---

## ğŸ” å¯†é’¥ç”Ÿæˆæ­¥éª¤

### åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆ PEM æ ¼å¼å¯†é’¥å¯¹

```bash
# ç”Ÿæˆ RSA 4096 ä½å¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -f ~/.ssh/server-key -C "server-$(date +%Y%m%d)" -m PEM

# ç”Ÿæˆçš„æ–‡ä»¶ï¼š
# - server-key (ç§é’¥ï¼Œéœ€è¦ä¿å¯†)
# - server-key.pub (å…¬é’¥ï¼Œå¯ä»¥å…¬å¼€)
```

### é…ç½®æœåŠ¡å™¨ç«¯

```bash
# å°†å…¬é’¥æ·»åŠ åˆ°æˆæƒæ–‡ä»¶
cat ~/.ssh/server-key.pub >> ~/.ssh/authorized_keys

# è®¾ç½®æ­£ç¡®çš„æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/server-key
chmod 644 ~/.ssh/server-key.pub
```

### é…ç½®å®¢æˆ·ç«¯

```bash
# 1. å°†ç§é’¥ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨å®‰å…¨æ–¹å¼ï¼Œå¦‚ Uç›˜ï¼‰
# 2. ç§»åŠ¨åˆ° .ssh ç›®å½•
mkdir -p ~/.ssh
mv server-key ~/.ssh/
chmod 600 ~/.ssh/server-key

# 3. æµ‹è¯•è¿æ¥
ssh -i ~/.ssh/server-key your_username@your_server_ip
```

---

## ğŸ“ æ–‡ä»¶ä¼ è¾“

### ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# å•ä¸ªæ–‡ä»¶
scp -i ~/.ssh/your-server-key.pem local_file.txt your_username@your_server_ip:~/

# æ•´ä¸ªç›®å½•
scp -i ~/.ssh/your-server-key.pem -r local_folder/ your_username@your_server_ip:~/
```

### ä»æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶

```bash
# å•ä¸ªæ–‡ä»¶
scp -i ~/.ssh/your-server-key.pem your_username@your_server_ip:~/remote_file.txt ./

# æ•´ä¸ªç›®å½•
scp -i ~/.ssh/your-server-key.pem -r your_username@your_server_ip:~/remote_folder/ ./
```

---

## ğŸ–¥ï¸ VS Code è¿œç¨‹å¼€å‘

### 1. å®‰è£…æ‰©å±•

åœ¨ VS Code ä¸­å®‰è£… `Remote - SSH` æ‰©å±•ã€‚

### 2. é…ç½® SSH

ç¡®ä¿ `~/.ssh/config` å·²æ­£ç¡®é…ç½®ï¼ˆè§ä¸Šæ–‡ï¼‰ã€‚

### 3. è¿æ¥åˆ°æœåŠ¡å™¨

1. æŒ‰ `F1` æˆ– `Cmd+Shift+P`
2. è¾“å…¥ `Remote-SSH: Connect to Host`
3. é€‰æ‹©é…ç½®çš„æœåŠ¡å™¨åˆ«å
4. å¼€å§‹è¿œç¨‹å¼€å‘

### 4. ç«¯å£è½¬å‘

å¦‚æœéœ€è¦è®¿é—®æœåŠ¡å™¨ä¸Šçš„ Web æœåŠ¡ï¼š

```bash
# æ–¹å¼ 1: SSH å‘½ä»¤è¡Œ
ssh -i ~/.ssh/your-server-key.pem -L 8080:localhost:3000 your_username@your_server_ip

# æ–¹å¼ 2: åœ¨ VS Code çš„ç«¯å£è½¬å‘é¢æ¿ä¸­é…ç½®
# æœ¬åœ°ç«¯å£: 8080
# è¿œç¨‹ç«¯å£: 3000
```

ç„¶ååœ¨æµè§ˆå™¨è®¿é—® `http://localhost:8080`

---

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

### 1. å¯†é’¥æƒé™

```bash
# ç§é’¥å¿…é¡»æ˜¯ 600
chmod 600 ~/.ssh/your-server-key.pem

# å…¬é’¥å¯ä»¥æ˜¯ 644
chmod 644 ~/.ssh/your-server-key.pem.pub

# .ssh ç›®å½•åº”è¯¥æ˜¯ 700
chmod 700 ~/.ssh

# authorized_keys åº”è¯¥æ˜¯ 600
chmod 600 ~/.ssh/authorized_keys
```

### 2. æœåŠ¡å™¨ SSH é…ç½®åŠ å›º

ç¼–è¾‘ `/etc/ssh/sshd_config`ï¼š

```bash
# å¯ç”¨å…¬é’¥è®¤è¯
PubkeyAuthentication yes

# ç¦ç”¨å¯†ç ç™»å½•ï¼ˆç¡®ä¿å¯†é’¥ç™»å½•æ­£å¸¸åå†å¯ç”¨ï¼‰
PasswordAuthentication no

# ç¦ç”¨ root ç›´æ¥ç™»å½•
PermitRootLogin no

# é™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°
MaxAuthTries 3

# è®¾ç½®ç©ºé—²è¶…æ—¶
ClientAliveInterval 300
ClientAliveCountMax 2
```

é‡å¯ SSH æœåŠ¡ï¼š

```bash
sudo systemctl restart sshd
```

### 3. å®šæœŸè½®æ¢å¯†é’¥

å»ºè®®æ¯ 3-6 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ SSH å¯†é’¥ã€‚

### 4. å¯†é’¥å¤‡ä»½

- å°†ç§é’¥å¤‡ä»½åˆ°å®‰å…¨çš„å¯†ç ç®¡ç†å™¨
- ä¸è¦é€šè¿‡äº‘ç›˜åŒæ­¥
- ä¸è¦é€šè¿‡é‚®ä»¶æˆ–èŠå¤©å·¥å…·ä¼ è¾“

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Permission denied (publickey)

**åŸå› **: ç§é’¥æ–‡ä»¶æƒé™ä¸æ­£ç¡®

**è§£å†³**:
```bash
chmod 600 ~/.ssh/your-server-key.pem
```

### é—®é¢˜ 2: WARNING: UNPROTECTED PRIVATE KEY FILE!

**åŸå› **: ç§é’¥æ–‡ä»¶æƒé™è¿‡äºå¼€æ”¾

**è§£å†³**:
```bash
chmod 600 ~/.ssh/your-server-key.pem
```

### é—®é¢˜ 3: ä»ç„¶è¦æ±‚è¾“å…¥å¯†ç 

**å¯èƒ½åŸå› **:
1. æœåŠ¡å™¨ç«¯ `PubkeyAuthentication` æœªå¯ç”¨
2. `~/.ssh/authorized_keys` æƒé™ä¸æ­£ç¡®
3. ä½¿ç”¨äº†é”™è¯¯çš„ç§é’¥

**è§£å†³**:
```bash
# åœ¨æœåŠ¡å™¨ç«¯æ£€æŸ¥
sudo grep "PubkeyAuthentication" /etc/ssh/sshd_config
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh

# åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ -v å‚æ•°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
ssh -v -i ~/.ssh/your-server-key.pem your_username@your_server_ip
```

### é—®é¢˜ 4: Host key verification failed

**åŸå› **: æœåŠ¡å™¨çš„ host key å‘ç”Ÿå˜åŒ–

**è§£å†³**:
```bash
# ä» known_hosts ä¸­åˆ é™¤æ—§çš„è®°å½•
ssh-keygen -R your_server_ip

# æˆ–è€…ç¼–è¾‘ ~/.ssh/known_hosts æ‰‹åŠ¨åˆ é™¤å¯¹åº”è¡Œ
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [æ•æ„Ÿä¿¡æ¯ç®¡ç†è§„èŒƒ](./00-æ•æ„Ÿä¿¡æ¯ç®¡ç†è§„èŒƒ.md)
- [è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æ‰‹å†Œ](./06-è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æ‰‹å†Œ.md)
- [éƒ¨ç½²æŒ‡å—](./01-éƒ¨ç½²æŒ‡å—.md)

---

## âš ï¸ é‡è¦æé†’

1. **ä¸è¦åœ¨æœ¬æ–‡æ¡£ä¸­å¡«å†™çœŸå®çš„è¿æ¥ä¿¡æ¯**
2. **çœŸå®ä¿¡æ¯åº”å­˜æ”¾åœ¨** `private-configs/` ç›®å½• (é¡¹ç›®æ ¹ç›®å½•)
3. **ç§é’¥æ–‡ä»¶å¿…é¡»è®¾ç½® 600 æƒé™**
4. **å®šæœŸè½®æ¢ SSH å¯†é’¥**
5. **å°†ç§é’¥å¤‡ä»½åˆ°å®‰å…¨ä½ç½®**

---

*æœ€åæ›´æ–°: 2025-11-10*  
*ç‰ˆæœ¬: v1.0*  
*çŠ¶æ€: âœ… å…¬å¼€æ¨¡æ¿*

