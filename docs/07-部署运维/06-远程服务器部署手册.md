# AIcoin è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æ‰‹å†Œ

## ğŸ“‹ ç›®æ ‡æœåŠ¡å™¨ä¿¡æ¯

- **æœåŠ¡å™¨IP**: 192.168.31.85
- **ç”¨æˆ·å**: allenxing07
- **å¯†ç **: xhl196312
- **éƒ¨ç½²ç›®å½•**: /home/allenxing07/AIcoin

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æµç¨‹

### æ–¹å¼ä¸€: è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆæ¨èï¼‰

åœ¨**æœ¬åœ°**æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```bash
cd /Users/xinghailong/Documents/soft/AIcoin

# 1. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/deploy_to_remote.sh
chmod +x scripts/check_remote_env.sh

# 2. æ£€æŸ¥è¿œç¨‹ç¯å¢ƒ
./scripts/check_remote_env.sh

# 3. æ‰§è¡Œè‡ªåŠ¨éƒ¨ç½²
./scripts/deploy_to_remote.sh
```

**éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ:**
- âœ… SSHè¿æ¥æ£€æŸ¥
- âœ… è¿œç¨‹ç¯å¢ƒæ£€æŸ¥ï¼ˆDockerã€ç£ç›˜ã€å†…å­˜ç­‰ï¼‰
- âœ… ä»£ç åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨
- âœ… åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
- âœ… æ„å»ºDockeré•œåƒ
- âœ… å¯åŠ¨æ‰€æœ‰æœåŠ¡

---

### æ–¹å¼äºŒ: æ‰‹åŠ¨éƒ¨ç½²

#### æ­¥éª¤1: SSHè¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh allenxing07@192.168.31.85
# è¾“å…¥å¯†ç : xhl196312
```

#### æ­¥éª¤2: å®‰è£…Dockerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt-get update

# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version

# é‡æ–°ç™»å½•ä»¥ä½¿ç»„æƒé™ç”Ÿæ•ˆ
exit
ssh allenxing07@192.168.31.85
```

#### æ­¥éª¤3: ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

åœ¨**æœ¬åœ°**æ‰§è¡Œ:

```bash
# ä½¿ç”¨rsyncåŒæ­¥ä»£ç 
rsync -avz --progress \
  --exclude 'node_modules' \
  --exclude '__pycache__' \
  --exclude '*.pyc' \
  --exclude '.git' \
  --exclude 'logs' \
  --exclude '*.log' \
  --exclude 'backend.pid' \
  --exclude 'celerybeat-schedule' \
  --exclude '.env' \
  --exclude 'frontend/.next' \
  /Users/xinghailong/Documents/soft/AIcoin/ \
  allenxing07@192.168.31.85:/home/allenxing07/AIcoin/
```

#### æ­¥éª¤4: é…ç½®ç¯å¢ƒå˜é‡

SSHåˆ°æœåŠ¡å™¨å:

```bash
cd /home/allenxing07/AIcoin

# åˆ›å»º.envæ–‡ä»¶
cat > .env << 'EOF'
# Database
POSTGRES_USER=aicoin
POSTGRES_PASSWORD=aicoin_prod_2025
DATABASE_URL=postgresql://aicoin:aicoin_prod_2025@postgres:5432/aicoin

# Redis
REDIS_URL=redis://redis:6379

# Qdrant
QDRANT_HOST=qdrant
QDRANT_PORT=6333

# Security (ä½¿ç”¨opensslç”Ÿæˆéšæœºå¯†é’¥)
SECRET_KEY=$(openssl rand -hex 32)
JWT_SECRET_KEY=$(openssl rand -hex 32)
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# AI API Keys (å¿…é¡»å¡«å†™)
DEEPSEEK_API_KEY=sk-your-deepseek-api-key
QWEN_API_KEY=sk-your-qwen-api-key
GROK_API_KEY=xai-your-grok-api-key
CLAUDE_API_KEY=sk-ant-your-claude-api-key
OPENAI_API_KEY=sk-your-openai-api-key

# Hyperliquid (å¿…é¡»å¡«å†™)
HYPERLIQUID_WALLET_ADDRESS=0x...
HYPERLIQUID_PRIVATE_KEY=0x...
HYPERLIQUID_VAULT_ADDRESS=
HYPERLIQUID_TESTNET=false
HYPERLIQUID_API_URL=https://api.hyperliquid.xyz

# Trading Config
TRADING_ENABLED=false
DECISION_INTERVAL=300
INITIAL_PERMISSION_LEVEL=L1
DEFAULT_SYMBOL=BTC-PERP

# Risk Management
MAX_POSITION_SIZE=10000
MAX_DAILY_LOSS=1000
MAX_DRAWDOWN=0.15
MAX_POSITION_PCT=0.20
MAX_DAILY_LOSS_PCT=0.05
MAX_DRAWDOWN_PCT=0.10

# Frontend
NEXT_PUBLIC_API_URL=http://192.168.31.85:8000

# App Config
APP_VERSION=3.1.0
EOF

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å†™å®é™…çš„APIå¯†é’¥å’Œé’±åŒ…ä¿¡æ¯
nano .env
```

**å¿…é¡»ä¿®æ”¹çš„é…ç½®é¡¹:**
- `DEEPSEEK_API_KEY`: DeepSeek APIå¯†é’¥
- `HYPERLIQUID_WALLET_ADDRESS`: é’±åŒ…åœ°å€
- `HYPERLIQUID_PRIVATE_KEY`: é’±åŒ…ç§é’¥
- å…¶ä»–AI APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰

#### æ­¥éª¤5: æ„å»ºDockeré•œåƒ

```bash
cd /home/allenxing07/AIcoin

# æ„å»ºåç«¯é•œåƒ
cd backend
docker build -t aicoin-backend:latest .

# æ„å»ºå‰ç«¯é•œåƒ
cd ../frontend
docker build -t aicoin-frontend:latest .

cd ..
```

#### æ­¥éª¤6: å¯åŠ¨æœåŠ¡

```bash
cd /home/allenxing07/AIcoin

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f deploy/docker-compose.prod.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f deploy/docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs -f
```

#### æ­¥éª¤7: åˆå§‹åŒ–æ•°æ®åº“

```bash
cd /home/allenxing07/AIcoin

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/init_remote_db.sh

# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–
./scripts/init_remote_db.sh
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
cd /home/allenxing07/AIcoin
docker-compose -f deploy/docker-compose.prod.yml ps
```

æ‰€æœ‰æœåŠ¡åº”è¯¥æ˜¾ç¤ºä¸º `Up` çŠ¶æ€ã€‚

### 2. æ£€æŸ¥åç«¯å¥åº·

```bash
curl http://localhost:8000/health
```

åº”è¯¥è¿”å›:
```json
{"status":"healthy","version":"3.1.0"}
```

### 3. æ£€æŸ¥å‰ç«¯

```bash
curl http://localhost:3000
```

åº”è¯¥è¿”å›HTMLå†…å®¹ã€‚

### 4. è®¿é—®ç³»ç»Ÿ

åœ¨æµè§ˆå™¨ä¸­è®¿é—®:
- **å‰ç«¯ç•Œé¢**: http://192.168.31.85:3000
- **åç«¯API**: http://192.168.31.85:8000
- **APIæ–‡æ¡£**: http://192.168.31.85:8000/docs
- **Qdrantæ§åˆ¶å°**: http://192.168.31.85:6333/dashboard

### 5. æ£€æŸ¥æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs -f

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs -f backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs -f frontend

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs -f postgres
```

---

## ğŸ“Š æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡

```bash
cd /home/allenxing07/AIcoin
docker-compose -f deploy/docker-compose.prod.yml up -d
```

### åœæ­¢æœåŠ¡

```bash
cd /home/allenxing07/AIcoin
docker-compose -f deploy/docker-compose.prod.yml down
```

### é‡å¯æœåŠ¡

```bash
cd /home/allenxing07/AIcoin
docker-compose -f deploy/docker-compose.prod.yml restart
```

### é‡å¯å•ä¸ªæœåŠ¡

```bash
# é‡å¯åç«¯
docker-compose -f deploy/docker-compose.prod.yml restart backend

# é‡å¯å‰ç«¯
docker-compose -f deploy/docker-compose.prod.yml restart frontend

# é‡å¯æ•°æ®åº“
docker-compose -f deploy/docker-compose.prod.yml restart postgres
```

### æŸ¥çœ‹èµ„æºä½¿ç”¨

```bash
docker stats
```

### æ¸…ç†æœªä½¿ç”¨çš„èµ„æº

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -f

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune -f

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune -f

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -af
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### 1. æ‹‰å–æœ€æ–°ä»£ç 

åœ¨**æœ¬åœ°**æ‰§è¡Œ:

```bash
cd /Users/xinghailong/Documents/soft/AIcoin
git pull

# åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨
rsync -avz --progress \
  --exclude 'node_modules' \
  --exclude '__pycache__' \
  --exclude '.git' \
  --exclude 'logs' \
  --exclude '.env' \
  /Users/xinghailong/Documents/soft/AIcoin/ \
  allenxing07@192.168.31.85:/home/allenxing07/AIcoin/
```

### 2. é‡æ–°æ„å»ºé•œåƒ

SSHåˆ°æœåŠ¡å™¨:

```bash
cd /home/allenxing07/AIcoin

# é‡æ–°æ„å»º
docker-compose -f deploy/docker-compose.prod.yml build

# é‡å¯æœåŠ¡
docker-compose -f deploy/docker-compose.prod.yml up -d
```

---

## ğŸ’¾ æ•°æ®å¤‡ä»½

### å¤‡ä»½PostgreSQL

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /home/allenxing07/backups

# å¤‡ä»½æ•°æ®åº“
docker exec aicoin-postgres-prod pg_dump -U aicoin aicoin > /home/allenxing07/backups/aicoin_$(date +%Y%m%d_%H%M%S).sql
```

### å¤‡ä»½Redis

```bash
# è§¦å‘Redisä¿å­˜
docker exec aicoin-redis-prod redis-cli BGSAVE

# å¤åˆ¶RDBæ–‡ä»¶
docker cp aicoin-redis-prod:/data/dump.rdb /home/allenxing07/backups/redis_$(date +%Y%m%d_%H%M%S).rdb
```

### å¤‡ä»½Qdrant

```bash
# å¤‡ä»½Qdrantæ•°æ®
docker cp aicoin-qdrant-prod:/qdrant/storage /home/allenxing07/backups/qdrant_$(date +%Y%m%d_%H%M%S)
```

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»ºå®šæ—¶å¤‡ä»½ä»»åŠ¡:

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /home/allenxing07/AIcoin/scripts/backup_all.sh
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulpn | grep :8000
sudo netstat -tulpn | grep :3000

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

### é—®é¢˜2: DockeræœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
sudo systemctl status docker

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable docker
```

### é—®é¢˜3: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥PostgreSQLå®¹å™¨
docker-compose -f deploy/docker-compose.prod.yml ps postgres

# æŸ¥çœ‹PostgreSQLæ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs postgres

# é‡å¯PostgreSQL
docker-compose -f deploy/docker-compose.prod.yml restart postgres
```

### é—®é¢˜4: å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æ¸…ç†Dockerç¼“å­˜
docker system prune -af

# é™åˆ¶å®¹å™¨å†…å­˜ï¼ˆç¼–è¾‘docker-compose.ymlï¼‰
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 2G
```

### é—®é¢˜5: å‰ç«¯æ— æ³•è®¿é—®åç«¯

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
docker network inspect aicoin-network

# æ£€æŸ¥.envä¸­çš„NEXT_PUBLIC_API_URL
cat .env | grep NEXT_PUBLIC_API_URL

# åº”è¯¥æ˜¯: NEXT_PUBLIC_API_URL=http://192.168.31.85:8000
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

```bash
# ä¿®æ”¹æ•°æ®åº“å¯†ç 
# ç¼–è¾‘.envæ–‡ä»¶
nano .env

# ä¿®æ”¹ä»¥ä¸‹é…ç½®
POSTGRES_PASSWORD=your-strong-password
DATABASE_URL=postgresql://aicoin:your-strong-password@postgres:5432/aicoin
```

### 2. é…ç½®é˜²ç«å¢™

```bash
# å®‰è£…UFW
sudo apt-get install ufw

# å…è®¸SSH
sudo ufw allow 22

# å…è®¸HTTP/HTTPS
sudo ufw allow 80
sudo ufw allow 443

# å…è®¸åº”ç”¨ç«¯å£ï¼ˆä»…å†…ç½‘ï¼‰
sudo ufw allow from 192.168.31.0/24 to any port 8000
sudo ufw allow from 192.168.31.0/24 to any port 3000

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

### 3. è®¾ç½®SSHå¯†é’¥è®¤è¯

åœ¨**æœ¬åœ°**ç”ŸæˆSSHå¯†é’¥:

```bash
# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t ed25519 -C "your_email@example.com"

# å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id allenxing07@192.168.31.85
```

### 4. å®šæœŸæ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt-get update
sudo apt-get upgrade -y

# æ›´æ–°Dockeré•œåƒ
docker-compose -f deploy/docker-compose.prod.yml pull
docker-compose -f deploy/docker-compose.prod.yml up -d
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### å®æ—¶ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs --tail=100

# è¿‡æ»¤é”™è¯¯æ—¥å¿—
docker-compose -f deploy/docker-compose.prod.yml logs | grep -i error

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
docker-compose -f deploy/docker-compose.prod.yml logs > /home/allenxing07/logs/aicoin_$(date +%Y%m%d).log
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. è°ƒæ•´Workeræ•°é‡

ç¼–è¾‘ `deploy/docker-compose.prod.yml`:

```yaml
backend:
  command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

### 2. å¯ç”¨RedisæŒä¹…åŒ–

ç¼–è¾‘ `deploy/docker-compose.prod.yml`:

```yaml
redis:
  command: redis-server --appendonly yes --save 60 1000
```

### 3. ä¼˜åŒ–PostgreSQL

```bash
# è¿›å…¥PostgreSQLå®¹å™¨
docker exec -it aicoin-postgres-prod psql -U aicoin

# è°ƒæ•´é…ç½®
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
ALTER SYSTEM SET maintenance_work_mem = '64MB';

# é‡å¯PostgreSQL
docker-compose -f deploy/docker-compose.prod.yml restart postgres
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨ç¯å¢ƒæ£€æŸ¥é€šè¿‡
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] ä»£ç å·²åŒæ­¥åˆ°æœåŠ¡å™¨
- [ ] .envæ–‡ä»¶å·²æ­£ç¡®é…ç½®
- [ ] APIå¯†é’¥å·²å¡«å†™
- [ ] é’±åŒ…åœ°å€å’Œç§é’¥å·²é…ç½®
- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] æ‰€æœ‰æœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å‰ç«¯å¯ä»¥è®¿é—®
- [ ] æ—¥å¿—æ— ä¸¥é‡é”™è¯¯
- [ ] å¤‡ä»½ç­–ç•¥å·²é…ç½®
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] ç›‘æ§å·²è®¾ç½®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜:

1. æŸ¥çœ‹æ—¥å¿—: `docker-compose logs -f`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€: `docker-compose ps`
3. æŸ¥çœ‹ç³»ç»Ÿèµ„æº: `docker stats`
4. å‚è€ƒæ•…éšœæ’æŸ¥ç« èŠ‚

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
- **ç³»ç»Ÿç‰ˆæœ¬**: AIcoin v3.1.0
- **æ›´æ–°æ—¥æœŸ**: 2025-11-06
- **é€‚ç”¨æœåŠ¡å™¨**: 192.168.31.85

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€**

