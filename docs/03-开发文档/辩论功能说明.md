# è¾©è®ºåŠŸèƒ½è¯´æ˜æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å¤šç©ºè¾©è®ºç³»ç»Ÿæ˜¯AIcoinçš„æ ¸å¿ƒæ™ºèƒ½å†³ç­–æ¨¡å—ï¼Œé€šè¿‡æ¨¡æ‹Ÿå¤šå¤´ï¼ˆBullï¼‰å’Œç©ºå¤´ï¼ˆBearï¼‰åˆ†æå¸ˆçš„è¾©è®ºï¼Œç”±ç ”ç©¶ç»ç†ï¼ˆResearch Managerï¼‰ç»¼åˆåˆ¤æ–­ï¼Œç”Ÿæˆæ›´å¯é çš„å¸‚åœºåˆ†ææŠ¥å‘Šã€‚

---

## ğŸ”„ ä¸¤ç§è§¦å‘æ–¹å¼

### 1ï¸âƒ£ è‡ªåŠ¨è§¦å‘ï¼ˆæ¨èï¼‰âœ…

**å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç”Ÿæˆ**
- **è°ƒåº¦æ—¶é—´**ï¼šæ¯4å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆ00:00, 04:00, 08:00, 12:00, 16:00, 20:00ï¼‰
- **ç¼“å­˜æœºåˆ¶**ï¼šç»“æœç¼“å­˜30åˆ†é’Ÿ
- **æ™ºèƒ½è·³è¿‡**ï¼šå¦‚ç¼“å­˜å‰©ä½™æ—¶é—´ >10åˆ†é’Ÿï¼Œè·³è¿‡ç”Ÿæˆ
- **ç”¨æˆ·ä½“éªŒ**ï¼šè®¿é—®å³å¾—ï¼Œæ— éœ€ç­‰å¾…

**å·¥ä½œæµç¨‹**ï¼š
```
å®šæ—¶å™¨è§¦å‘ (æ¯4å°æ—¶)
    â†“
æ£€æŸ¥Redisç¼“å­˜
    â†“
[ç¼“å­˜æœ‰æ•ˆ] â†’ è·³è¿‡ç”Ÿæˆ
[ç¼“å­˜è¿‡æœŸ] â†’ æ‰§è¡Œè¾©è®º (60-90ç§’)
    â†“
ç¼“å­˜åˆ°Redis (30åˆ†é’ŸTTL)
    â†“
ç”¨æˆ·è®¿é—® â†’ ç§’çº§å“åº” (<2ç§’)
```

**å®ç°ä»£ç **ï¼š
- å®šæ—¶ä»»åŠ¡ï¼š`backend/app/tasks/intelligence_learning.py`
- ä»»åŠ¡åç§°ï¼š`auto_generate_debate_report`
- Celeryè°ƒåº¦ï¼š`crontab(minute=0, hour='*/4')`

---

### 2ï¸âƒ£ æ‰‹åŠ¨è§¦å‘

**ç”¨æˆ·ç‚¹å‡»è§¦å‘**
- **è§¦å‘æ–¹å¼**ï¼šç‚¹å‡»å‰ç«¯"ç”Ÿæˆè¾©è®º"æŒ‰é’®
- **å“åº”æ—¶é—´**ï¼šç«‹å³è¿”å›ï¼ˆåå°å¼‚æ­¥æ‰§è¡Œï¼‰
- **æ‰§è¡Œæ—¶é—´**ï¼š60-90ç§’
- **é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦å³æ—¶ç”Ÿæˆæœ€æ–°è¾©è®º

**APIæ¥å£**ï¼š
```http
POST /api/v1/intelligence/trigger-debate
```

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "è¾©è®ºå·²å¯åŠ¨ï¼Œæ­£åœ¨åå°æ‰§è¡Œä¸­...",
  "status": "processing",
  "estimated_time": "60-90ç§’"
}
```

---

## ğŸ¯ è¾©è®ºæµç¨‹

### ç¬¬1æ­¥ï¼šå¤šå¤´åˆ†æå¸ˆï¼ˆBull Analystï¼‰
- åˆ†æå¸‚åœºæ•°æ®å’Œæƒ…æŠ¥
- æå‡ºçœ‹æ¶¨è§‚ç‚¹å’Œç†ç”±
- å¼•ç”¨å†å²è®°å¿†å’ŒæˆåŠŸæ¡ˆä¾‹

### ç¬¬2æ­¥ï¼šç©ºå¤´åˆ†æå¸ˆï¼ˆBear Analystï¼‰
- åŸºäºç›¸åŒæ•°æ®æå‡ºåé©³
- æŒ‡å‡ºé£é™©å’Œæ½œåœ¨é—®é¢˜
- æä¾›çœ‹è·Œè®ºæ®

### ç¬¬3æ­¥ï¼šç ”ç©¶ç»ç†ï¼ˆResearch Managerï¼‰
- ç»¼åˆåŒæ–¹è§‚ç‚¹
- è¯„ä¼°å…±è¯†åº¦
- ç»™å‡ºæœ€ç»ˆå»ºè®®ï¼ˆBUY/SELL/HOLDï¼‰
- æä¾›ç½®ä¿¡åº¦è¯„åˆ†

---

## ğŸ“Š æ•°æ®ç»“æ„

### è¾©è®ºç»“æœæ ¼å¼

```json
{
  "success": true,
  "cached": true,
  "data": {
    "debate_result": {
      "recommendation": "HOLD",
      "confidence": 0.5,
      "reasoning": "ç»¼åˆåˆ¤æ–­...",
      "bull_argument": [
        "Bull Analyst: ### å¸‚åœºåˆ†æ...",
        "..."
      ],
      "bear_argument": [
        "Bear Analyst: ### é£é™©è¯„ä¼°...",
        "..."
      ],
      "consensus_level": 0.0,
      "total_rounds": 1,
      "duration_seconds": 68
    },
    "is_debated": true
  }
}
```

---

## ğŸš€ å¯ç”¨è‡ªåŠ¨è¾©è®º

### 1. ç¡®ä¿CeleryæœåŠ¡è¿è¡Œ

```bash
# æ£€æŸ¥Celeryè¿›ç¨‹
docker compose ps backend

# æŸ¥çœ‹Celeryæ—¥å¿—
docker compose logs -f backend | grep celery
```

### 2. éªŒè¯å®šæ—¶ä»»åŠ¡

```bash
# SSHåˆ°æœåŠ¡å™¨
ssh -i <key> root@<server>

# æ£€æŸ¥Celery Beatæ—¥å¿—
docker compose logs backend | grep "auto-generate-debate-report"
```

### 3. æ‰‹åŠ¨æµ‹è¯•ä»»åŠ¡

```python
from app.tasks.intelligence_learning import auto_generate_debate_report

# æ‰‹åŠ¨è§¦å‘
result = auto_generate_debate_report.delay()
```

---

## âš™ï¸ é…ç½®å‚æ•°

### å®šæ—¶ä»»åŠ¡é…ç½®
```python
# backend/app/tasks/intelligence_learning.py
'auto-generate-debate-report': {
    'task': 'app.tasks.intelligence_learning.auto_generate_debate_report',
    'schedule': crontab(minute=0, hour='*/4'),  # æ¯4å°æ—¶
}
```

### ç¼“å­˜é…ç½®
```python
# backend/app/api/v1/intelligence.py
CACHE_KEY = "debated_report:latest"
CACHE_TTL = 1800  # 30åˆ†é’Ÿ
SKIP_THRESHOLD = 600  # ç¼“å­˜å‰©ä½™>10åˆ†é’Ÿæ—¶è·³è¿‡
```

### è¾©è®ºé…ç½®
```python
# backend/app/services/decision/debate_system.py
max_debate_rounds = 1  # æœ€å¤§è¾©è®ºè½®æ¬¡
timeout_seconds = 60   # è¶…æ—¶ä¿æŠ¤
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ‰‹åŠ¨è§¦å‘ | è‡ªåŠ¨è§¦å‘ |
|------|---------|---------|
| ç”¨æˆ·ç­‰å¾…æ—¶é—´ | 90ç§’ | <2ç§’ |
| APIè°ƒç”¨æ¬¡æ•° | æ¯æ¬¡3æ¬¡ | æ¯4å°æ—¶3æ¬¡ |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | >90% |
| æˆæœ¬æ•ˆç‡ | ä½ | é«˜ |

---

## ğŸ” ç›‘æ§ä¸è°ƒè¯•

### 1. æ£€æŸ¥ç¼“å­˜çŠ¶æ€

```bash
# Rediså‘½ä»¤è¡Œ
docker exec aicoin-redis redis-cli

# æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨
EXISTS debated_report:latest

# æŸ¥çœ‹ç¼“å­˜å‰©ä½™æ—¶é—´
TTL debated_report:latest

# æŸ¥çœ‹ç¼“å­˜å†…å®¹ï¼ˆè­¦å‘Šï¼šå†…å®¹å¾ˆé•¿ï¼‰
GET debated_report:latest
```

### 2. æŸ¥çœ‹è¾©è®ºæ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘çš„è¾©è®ºæ‰§è¡Œ
docker compose logs backend | grep "è¾©è®º" | tail -50

# æŸ¥çœ‹æˆåŠŸçš„è¾©è®º
docker compose logs backend | grep "âœ… è¾©è®ºå®Œæˆ"

# æŸ¥çœ‹å¤±è´¥çš„è¾©è®º
docker compose logs backend | grep "âŒ è¾©è®º"
```

### 3. æ€§èƒ½ç›‘æ§

```bash
# æ£€æŸ¥è¾©è®ºæ‰§è¡Œæ—¶é—´
docker compose logs backend | grep "duration_seconds"

# æ£€æŸ¥APIå“åº”æ—¶é—´
curl -w "@curl-format.txt" -s "https://jifenpay.cc/api/v1/intelligence/debated-report"
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¾©è®ºå†…å®¹æ˜¯ç©ºçš„ï¼Ÿ
**A**: æ£€æŸ¥é”®åæ˜¯å¦åŒ¹é…ï¼š
- æ­£ç¡®ï¼š`bull_history`, `bear_history`
- é”™è¯¯ï¼š`bull_arguments`, `bear_arguments`

### Q2: å®šæ—¶ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œï¼Ÿ
**A**: ç¡®è®¤Celery Beatè¿›ç¨‹è¿è¡Œï¼š
```bash
docker compose logs backend | grep "celery beat"
```

### Q3: ç¼“å­˜ä¸€ç›´ä¸æ›´æ–°ï¼Ÿ
**A**: æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼š
```bash
docker exec aicoin-redis redis-cli DEL debated_report:latest
```

### Q4: è¾©è®ºè¶…æ—¶æ€ä¹ˆåŠï¼Ÿ
**A**: æ£€æŸ¥AI APIè¿æ¥ï¼š
```bash
docker compose logs backend | grep "deepseek"
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ¨èä½¿ç”¨è‡ªåŠ¨è§¦å‘
- âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆç§’çº§å“åº”ï¼‰
- âœ… æˆæœ¬æ›´ä½ï¼ˆé¿å…é‡å¤è°ƒç”¨ï¼‰
- âœ… æ—¶æ•ˆæ€§å¥½ï¼ˆå®šæœŸæ›´æ–°ï¼‰

### 2. ä»…åœ¨å¿…è¦æ—¶æ‰‹åŠ¨è§¦å‘
- é‡å¤§å¸‚åœºäº‹ä»¶å‘ç”Ÿ
- éœ€è¦å³æ—¶æœ€æ–°åˆ†æ
- å®šæ—¶ä»»åŠ¡å¤±è´¥æ—¶è¡¥æ•‘

### 3. åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´
- å¤ªçŸ­ï¼šAPIæˆæœ¬é«˜
- å¤ªé•¿ï¼šæ•°æ®æ—¶æ•ˆæ€§å·®
- **æ¨è**ï¼š30åˆ†é’Ÿï¼ˆå¹³è¡¡æˆæœ¬å’Œæ—¶æ•ˆï¼‰

---

## ğŸ“ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| v1.0 | 2025-11-16 | åˆå§‹ç‰ˆæœ¬ï¼Œä»…æ”¯æŒæ‰‹åŠ¨è§¦å‘ |
| v2.0 | 2025-11-16 | æ·»åŠ è‡ªåŠ¨è§¦å‘å®šæ—¶ä»»åŠ¡ |
| v2.1 | 2025-11-16 | ä¿®å¤è¾©è®ºè§‚ç‚¹æ˜¾ç¤ºé—®é¢˜ |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è¾©è®ºç³»ç»Ÿæ¶æ„](./è¾©è®ºç³»ç»Ÿæ¶æ„.md)
- [Celeryå®šæ—¶ä»»åŠ¡](./Celeryå®šæ—¶ä»»åŠ¡.md)
- [Redisç¼“å­˜ç­–ç•¥](./Redisç¼“å­˜ç­–ç•¥.md)
- [504è¶…æ—¶é—®é¢˜è¯Šæ–­](./504è¶…æ—¶é—®é¢˜è¯Šæ–­.md)

