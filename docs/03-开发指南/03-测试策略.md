# 测试策略

**文档编号**: AICOIN-DEV-003  
**文档版本**: v1.0.0  
**创建日期**: 2025-10-22

---

## 1. 测试金字塔

```
    ┌─────┐
    │ E2E │         10%
    ├─────┤
    │ 集成 │         30%
    ├─────┤
    │ 单元 │         60%
    └─────┘
```

---

## 2. 单元测试

### 2.1 pytest示例
```python
import pytest
from app.services.trading.risk_manager import RiskManager

def test_position_limit():
    risk_mgr = RiskManager()
    result = risk_mgr.check_position_limit(
        order_size=2000,
        total_balance=10000
    )
    assert result[0] == True  # 20%以内
    
    result = risk_mgr.check_position_limit(
        order_size=3000,
        total_balance=10000
    )
    assert result[0] == False  # 超过20%
```

### 2.2 运行测试
```bash
pytest tests/ -v --cov=app --cov-report=html
```

---

## 3. 集成测试

```python
from fastapi.testclient import TestClient

def test_api_get_trades():
    client = TestClient(app)
    response = client.get("/api/v1/trading/trades?limit=10")
    assert response.status_code == 200
    assert len(response.json()["data"]) <= 10
```

---

## 4. E2E测试

```typescript
// Playwright示例
test('完整交易流程', async ({ page }) => {
  await page.goto('http://localhost:3000');
  
  // 查看市场数据
  await page.click('[data-testid="market-btc"]');
  
  // 等待AI决策
  await page.waitForSelector('[data-testid="new-trade"]');
  
  // 验证交易记录
  const trades = await page.$$('[data-testid="trade-item"]');
  expect(trades.length).toBeGreaterThan(0);
});
```

---

## 5. 测试覆盖率要求

| 模块 | 覆盖率要求 |
|------|-----------|
| 核心业务逻辑 | ≥ 90% |
| API端点 | ≥ 80% |
| 工具函数 | ≥ 70% |

---

**文档结束**

