# 部署指南

**文档编号**: AICOIN-OPS-001  
**文档版本**: v1.0.0  
**创建日期**: 2025-10-22

---

## 1. 服务器要求

| 资源 | 最低配置 | 推荐配置 |
|------|---------|---------|
| CPU | 2核 | 4核 |
| 内存 | 4GB | 8GB |
| 磁盘 | 50GB SSD | 100GB SSD |
| 带宽 | 10Mbps | 50Mbps |

---

## 2. 快速部署 (Docker Compose)

### 2.1 克隆代码
```bash
git clone https://github.com/your-org/aicoin.git
cd aicoin
```

### 2.2 配置环境变量
```bash
cp .env.example .env
vim .env  # 填写API密钥等
```

### 2.3 启动服务
```bash
docker-compose up -d
```

### 2.4 初始化数据库
```bash
docker-compose exec backend alembic upgrade head
```

### 2.5 验证部署
```bash
curl http://localhost:8000/api/v1/health
```

---

## 3. 生产环境部署

### 3.1 购买VPS
推荐提供商:
- DigitalOcean ($48/月, 4核8G)
- Hetzner ($35/月, 4核8G)
- Oracle Cloud (免费层 4核24G)

### 3.2 安装Docker
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

### 3.3 配置域名与SSL
```bash
# 安装Nginx
sudo apt install nginx certbot python3-certbot-nginx

# 配置域名
sudo vim /etc/nginx/sites-available/aicoin

# 申请SSL证书
sudo certbot --nginx -d aicoin.ai
```

### 3.4 Nginx配置
```nginx
server {
    listen 443 ssl;
    server_name aicoin.ai;
    
    ssl_certificate /etc/letsencrypt/live/aicoin.ai/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aicoin.ai/privkey.pem;
    
    location /api/ {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
    }
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
    }
    
    location /ws {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

---

## 4. 数据备份

### 4.1 自动备份脚本
```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups"

# 备份数据库
docker-compose exec -T postgres pg_dump -U admin aicoin > $BACKUP_DIR/db_$DATE.sql

# 压缩
gzip $BACKUP_DIR/db_$DATE.sql

# 删除30天前的备份
find $BACKUP_DIR -name "db_*.sql.gz" -mtime +30 -delete
```

### 4.2 配置Crontab
```bash
# 每日凌晨3点备份
0 3 * * * /path/to/backup.sh
```

---

## 5. 监控告警

参考 [监控与日志 (AICOIN-OPS-003)](./03-监控与日志.md)

---

**文档结束**

