# âš¡ AIcoin æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

> **åˆ†ææ—¶é—´**: 2025-11-05  
> **å½“å‰çŠ¶æ€**: é¦–é¡µåŠ è½½æ…¢ã€APIè°ƒç”¨é¢‘ç¹  
> **ä¼˜åŒ–ç›®æ ‡**: é¦–é¡µåŠ è½½æ—¶é—´ < 2ç§’,APIå“åº” < 500ms

---

## ğŸ” æ€§èƒ½ç“¶é¢ˆåˆ†æ

### å½“å‰é—®é¢˜

#### 1. å‰ç«¯æ€§èƒ½é—®é¢˜ âŒ

```typescript
// frontend/app/page.tsx - ä¸»é¡µé¢
useEffect(() => {
  checkApiStatus();      // API 1
  fetchAccountData();    // API 2
  fetchModelsData();     // API 3
  fetchAiHealth();       // API 4
  
  const interval = setInterval(() => {
    // æ¯10ç§’æ‰§è¡Œ4ä¸ªAPIè°ƒç”¨! âŒ
    checkApiStatus();
    fetchAccountData();
    fetchModelsData();
    fetchAiHealth();
  }, 10000);
}, []);
```

**é—®é¢˜**:
- âŒ é¦–æ¬¡åŠ è½½4ä¸ªä¸²è¡ŒAPIè°ƒç”¨
- âŒ æ¯10ç§’é‡å¤4ä¸ªAPIè°ƒç”¨
- âŒ æ— ç¼“å­˜,æ¯æ¬¡éƒ½æ˜¯æ–°è¯·æ±‚
- âŒ æ— loadingä¼˜åŒ–,ç”¨æˆ·ä½“éªŒå·®

#### 2. å¤§å‹ç»„ä»¶é—®é¢˜ âŒ

- `IntelligenceConfigPanel.tsx`: 739è¡Œ (åº”æ‹†åˆ†)
- æ‰€æœ‰ç»„ä»¶éƒ½åœ¨é¦–é¡µç›´æ¥import
- æ— ä»£ç åˆ†å‰²,bundleè¿‡å¤§

#### 3. APIæ€§èƒ½é—®é¢˜ âŒ

```python
# backend - æ¯ä¸ªé¡µé¢éƒ½ç‹¬ç«‹è°ƒç”¨
GET /account/info       # é¢‘ç¹æŸ¥è¯¢
GET /performance/metrics  # è®¡ç®—å¯†é›†
GET /ai/status          # é¢‘ç¹æŸ¥è¯¢
```

---

## ğŸš€ ä¼˜åŒ–æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µ: å‰ç«¯æ€§èƒ½ä¼˜åŒ– âš¡

#### 1. APIè°ƒç”¨ä¼˜åŒ–

**é—®é¢˜**: 4ä¸ªä¸²è¡ŒAPIè°ƒç”¨,é¦–æ¬¡åŠ è½½æ…¢

**æ–¹æ¡ˆA**: æ‰¹é‡API (æ¨è)

```typescript
// âœ… åˆ›å»ºç»Ÿä¸€çš„ä»ªè¡¨æ¿API
GET /api/v1/dashboard/summary
Response: {
  api_status: {...},
  account: {...},
  models: {...},
  ai_health: {...}
}
```

**åç«¯å®ç°**:

```python
# backend/app/api/v1/dashboard.py
@router.get("/summary")
async def get_dashboard_summary(db: AsyncSession = Depends(get_db)):
    """ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ä»ªè¡¨æ¿æ•°æ®"""
    return {
        "api_status": await get_api_status(),
        "account": await get_account_info(),
        "models": await get_models_data(),
        "ai_health": await get_ai_health(),
        "timestamp": datetime.now()
    }
```

**å‰ç«¯ä½¿ç”¨**:

```typescript
// ä¼˜åŒ–å: åªéœ€1ä¸ªAPIè°ƒç”¨
useEffect(() => {
  fetchDashboardData();
  const interval = setInterval(fetchDashboardData, 30000); // 30ç§’åˆ·æ–°
  return () => clearInterval(interval);
}, []);

const fetchDashboardData = async () => {
  const res = await axios.get('/api/v1/dashboard/summary');
  const { api_status, account, models, ai_health } = res.data;
  setApiStatus(api_status);
  setAccountData(account);
  setModelsData(models);
  setAiHealth(ai_health);
};
```

**æ•ˆæœ**: 
- 4ä¸ªè¯·æ±‚ â†’ 1ä¸ªè¯·æ±‚
- åŠ è½½æ—¶é—´: ~2s â†’ ~500ms
- å‡å°‘70%çš„ç½‘ç»œå¼€é”€

---

#### 2. ç¼“å­˜ç­–ç•¥

**React Queryå®ç°**:

```bash
cd frontend
npm install @tanstack/react-query
```

```typescript
// frontend/app/providers/QueryProvider.tsx
'use client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 30000,      // 30ç§’å†…ä½¿ç”¨ç¼“å­˜
      cacheTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿç¼“å­˜
      refetchOnWindowFocus: false, // ä¸è‡ªåŠ¨é‡æ–°è·å–
    },
  },
});

export function QueryProvider({ children }) {
  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}
```

**ä½¿ç”¨**:

```typescript
// frontend/app/page.tsx
import { useQuery } from '@tanstack/react-query';

function Home() {
  const { data, isLoading } = useQuery({
    queryKey: ['dashboard'],
    queryFn: fetchDashboardData,
    refetchInterval: 30000,  // è‡ªåŠ¨30ç§’åˆ·æ–°
  });

  if (isLoading) return <LoadingSkeleton />;
  return <Dashboard data={data} />;
}
```

**æ•ˆæœ**:
- è‡ªåŠ¨ç¼“å­˜
- é¿å…é‡å¤è¯·æ±‚
- åå°è‡ªåŠ¨åˆ·æ–°

---

#### 3. ä»£ç åˆ†å‰² (Code Splitting)

**é—®é¢˜**: æ‰€æœ‰ç»„ä»¶éƒ½åœ¨é¦–é¡µåŠ è½½

**æ–¹æ¡ˆ**: ä½¿ç”¨åŠ¨æ€å¯¼å…¥

```typescript
// frontend/app/page.tsx
import dynamic from 'next/dynamic';

// âœ… æ‡’åŠ è½½å¤§å‹ç»„ä»¶
const IntelligencePanel = dynamic(
  () => import('./components/intelligence/IntelligencePanel'),
  { ssr: false, loading: () => <Loading /> }
);

const PerformanceDashboard = dynamic(
  () => import('./components/performance/PerformanceDashboard'),
  { ssr: false }
);

const AIDecisionChat = dynamic(
  () => import('./components/chat/AIDecisionChat'),
  { ssr: false }
);
```

**æ•ˆæœ**:
- é¦–æ¬¡åŠ è½½JS: ~2MB â†’ ~500KB
- é¦–å±æ¸²æŸ“æ—¶é—´: 3s â†’ 1s

---

#### 4. ç»„ä»¶æ‹†åˆ†

**å¤§å‹ç»„ä»¶**: `IntelligenceConfigPanel.tsx` (739è¡Œ)

**æ‹†åˆ†æ–¹æ¡ˆ**:

```typescript
// æ‹†åˆ†ä¸ºå¤šä¸ªå°ç»„ä»¶
components/intelligence/
â”œâ”€â”€ IntelligenceConfigPanel.tsx (ä¸»ç»„ä»¶,100è¡Œ)
â”œâ”€â”€ PlatformSelector.tsx (å¹³å°é€‰æ‹©,80è¡Œ)
â”œâ”€â”€ ModelConfig.tsx (æ¨¡å‹é…ç½®,100è¡Œ)
â”œâ”€â”€ VerificationSettings.tsx (éªŒè¯è®¾ç½®,80è¡Œ)
â”œâ”€â”€ PromptEditor.tsx (æç¤ºè¯ç¼–è¾‘,100è¡Œ)
â””â”€â”€ hooks/
    â”œâ”€â”€ useIntelligenceConfig.ts (é€»è¾‘æŠ½ç¦»)
    â””â”€â”€ usePlatformStatus.ts
```

---

### ç¬¬äºŒé˜¶æ®µ: åç«¯æ€§èƒ½ä¼˜åŒ– ğŸš€

#### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜**: N+1æŸ¥è¯¢

```python
# âŒ æ…¢æŸ¥è¯¢
for trade in trades:
    account = db.query(Account).filter_by(id=trade.account_id).first()
```

**ä¼˜åŒ–**: ä½¿ç”¨joinæˆ–æ‰¹é‡æŸ¥è¯¢

```python
# âœ… ä¼˜åŒ–å
trades = db.query(Trade).options(
    joinedload(Trade.account)
).all()
```

**æ·»åŠ ç´¢å¼•**:

```python
# backend/alembic/versions/011_add_performance_indexes.py
def upgrade():
    # å¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
    op.create_index('idx_trades_timestamp', 'trades', ['timestamp'])
    op.create_index('idx_trades_model_status', 'trades', ['model_slug', 'status'])
    op.create_index('idx_ai_decisions_created_at', 'ai_decisions', ['created_at'])
```

---

#### 2. APIå“åº”ç¼“å­˜

**ä½¿ç”¨Redisç¼“å­˜**:

```python
# backend/app/core/cache.py
import redis
import json
from functools import wraps

redis_client = redis.Redis(host='localhost', port=6379, db=0)

def cache_response(expire=30):
    """ç¼“å­˜è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            cache_key = f"{func.__name__}:{str(args)}:{str(kwargs)}"
            
            # å°è¯•ä»ç¼“å­˜è·å–
            cached = redis_client.get(cache_key)
            if cached:
                return json.loads(cached)
            
            # æ‰§è¡Œå‡½æ•°
            result = await func(*args, **kwargs)
            
            # ç¼“å­˜ç»“æœ
            redis_client.setex(
                cache_key, 
                expire, 
                json.dumps(result, default=str)
            )
            return result
        return wrapper
    return decorator
```

**ä½¿ç”¨**:

```python
# backend/app/api/v1/dashboard.py
@router.get("/summary")
@cache_response(expire=10)  # ç¼“å­˜10ç§’
async def get_dashboard_summary():
    return {
        "api_status": await get_api_status(),
        "account": await get_account_info(),
        # ...
    }
```

---

#### 3. å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜**: ä¸²è¡ŒæŸ¥è¯¢æ…¢

```python
# âŒ ä¸²è¡Œ
account = await get_account_info()
trades = await get_trades()
performance = await get_performance()
```

**ä¼˜åŒ–**: å¹¶å‘æŸ¥è¯¢

```python
# âœ… å¹¶å‘
import asyncio

async def get_dashboard_summary():
    account, trades, performance = await asyncio.gather(
        get_account_info(),
        get_trades(),
        get_performance()
    )
    return {"account": account, "trades": trades, "performance": performance}
```

**æ•ˆæœ**: 3ä¸ª300msè¯·æ±‚ â†’ å¹¶å‘300ms

---

#### 4. æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

```python
# backend/app/core/database.py
from sqlalchemy.ext.asyncio import create_async_engine

engine = create_async_engine(
    DATABASE_URL,
    pool_size=20,           # è¿æ¥æ± å¤§å°
    max_overflow=10,        # æœ€å¤§æº¢å‡º
    pool_pre_ping=True,     # è¿æ¥ä¿æ´»
    pool_recycle=3600,      # 1å°æ—¶å›æ”¶
    echo=False,             # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
)
```

---

### ç¬¬ä¸‰é˜¶æ®µ: åŠ è½½ä½“éªŒä¼˜åŒ– âœ¨

#### 1. Skeleton Loading

```typescript
// frontend/app/components/common/LoadingSkeleton.tsx
export function DashboardSkeleton() {
  return (
    <div className="animate-pulse">
      <div className="h-32 bg-gray-200 rounded-lg mb-4" />
      <div className="grid grid-cols-3 gap-4">
        <div className="h-24 bg-gray-200 rounded" />
        <div className="h-24 bg-gray-200 rounded" />
        <div className="h-24 bg-gray-200 rounded" />
      </div>
    </div>
  );
}
```

#### 2. æ¸è¿›å¼åŠ è½½

```typescript
// ä¼˜å…ˆåŠ è½½å…³é”®å†…å®¹
{isLoading ? (
  <DashboardSkeleton />
) : (
  <>
    {/* 1. å…³é”®æ•°æ®ç«‹å³æ˜¾ç¤º */}
    <PriceTicker data={data?.ticker} />
    
    {/* 2. æ¬¡è¦å†…å®¹å»¶è¿ŸåŠ è½½ */}
    <Suspense fallback={<LoadingSkeleton />}>
      <TradeList />
    </Suspense>
    
    {/* 3. éå…³é”®å†…å®¹æœ€ååŠ è½½ */}
    <Suspense fallback={null}>
      <PerformanceDashboard />
    </Suspense>
  </>
)}
```

---

### ç¬¬å››é˜¶æ®µ: Next.jsä¼˜åŒ– ğŸ¯

#### 1. é™æ€ç”Ÿæˆ (ISR)

```typescript
// frontend/app/admin/layout.tsx
export const revalidate = 60; // 60ç§’é‡æ–°ç”Ÿæˆ

export default async function AdminLayout({ children }) {
  // è¿™éƒ¨åˆ†ä¼šåœ¨æœåŠ¡å™¨ç«¯é¢„æ¸²æŸ“
  return <div>{children}</div>;
}
```

#### 2. å›¾ç‰‡ä¼˜åŒ–

```typescript
// ä½¿ç”¨Next.js Imageç»„ä»¶
import Image from 'next/image';

<Image
  src="/logo.png"
  width={200}
  height={50}
  alt="Logo"
  priority  // å…³é”®å›¾ç‰‡ä¼˜å…ˆåŠ è½½
/>
```

#### 3. å­—ä½“ä¼˜åŒ–

```typescript
// frontend/app/layout.tsx
import { Inter } from 'next/font/google';

const inter = Inter({ 
  subsets: ['latin'],
  display: 'swap',  // å­—ä½“äº¤æ¢ç­–ç•¥
});
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœé¢„æœŸ

### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **é¦–é¡µåŠ è½½æ—¶é—´** | ~5s | ~1.5s | 70% â†“ |
| **é¦–æ¬¡APIè°ƒç”¨** | 4ä¸ªä¸²è¡Œ | 1ä¸ªå¹¶å‘ | 75% â†“ |
| **JS Bundleå¤§å°** | ~2MB | ~500KB | 75% â†“ |
| **APIå“åº”æ—¶é—´** | ~800ms | ~200ms | 75% â†“ |
| **å†…å­˜å ç”¨** | ~150MB | ~80MB | 47% â†“ |
| **åˆ·æ–°é¢‘ç‡** | 10ç§’ | 30ç§’ | å‡å°‘æœåŠ¡å™¨è´Ÿè½½ |

### Lighthouseè¯„åˆ†é¢„æœŸ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| Performance | 45 | 85+ |
| Accessibility | 90 | 95+ |
| Best Practices | 80 | 95+ |
| SEO | 85 | 95+ |

---

## ğŸ› ï¸ å®æ–½æ­¥éª¤

### Phase 1: å¿«é€Ÿä¼˜åŒ– (1-2å°æ—¶)

```bash
# 1. åˆ›å»ºä»ªè¡¨æ¿API
touch backend/app/api/v1/dashboard.py

# 2. æ·»åŠ ä»£ç åˆ†å‰²
# ä¿®æ”¹ frontend/app/page.tsx

# 3. å¢åŠ ç¼“å­˜æ—¶é—´
# ä¿®æ”¹åˆ·æ–°é—´éš”: 10s â†’ 30s
```

### Phase 2: ä¸­æœŸä¼˜åŒ– (4-6å°æ—¶)

```bash
# 1. å®‰è£…React Query
cd frontend && npm install @tanstack/react-query

# 2. åˆ›å»ºç¼“å­˜å±‚
# backend/app/core/cache.py

# 3. æ·»åŠ æ•°æ®åº“ç´¢å¼•
alembic revision -m "add_performance_indexes"
```

### Phase 3: æ·±åº¦ä¼˜åŒ– (1-2å¤©)

```bash
# 1. ç»„ä»¶æ‹†åˆ†
# æ‹†åˆ†å¤§å‹ç»„ä»¶

# 2. æ€§èƒ½ç›‘æ§
npm install @vercel/analytics

# 3. å‹åŠ›æµ‹è¯•
pip install locust
```

---

## ğŸ“ ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### å‰ç«¯ä¼˜åŒ–

- [ ] åˆå¹¶APIè°ƒç”¨ (4ä¸ª â†’ 1ä¸ª)
- [ ] å®‰è£…React Query
- [ ] æ·»åŠ ä»£ç åˆ†å‰² (dynamic import)
- [ ] æ‹†åˆ†å¤§å‹ç»„ä»¶ (>500è¡Œ)
- [ ] æ·»åŠ Skeleton Loading
- [ ] ä¼˜åŒ–å›¾ç‰‡åŠ è½½
- [ ] å¢åŠ åˆ·æ–°é—´éš” (10s â†’ 30s)

### åç«¯ä¼˜åŒ–

- [ ] åˆ›å»ºä»ªè¡¨æ¿æ‰¹é‡API
- [ ] æ·»åŠ Redisç¼“å­˜
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] æ·»åŠ æ•°æ®åº“ç´¢å¼•
- [ ] å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–
- [ ] è¿æ¥æ± é…ç½®ä¼˜åŒ–

### ç›‘æ§ä¼˜åŒ–

- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] è®¾ç½®é”™è¯¯è¿½è¸ª
- [ ] æ·»åŠ APIå“åº”æ—¶é—´ç›‘æ§
- [ ] è®¾ç½®Lighthouse CI

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŒ–ä»£ç 

### 1. ä»ªè¡¨æ¿æ‰¹é‡API (æœ€é‡è¦!)

```python
# backend/app/api/v1/dashboard.py
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
import asyncio

router = APIRouter()

@router.get("/summary")
async def get_dashboard_summary(db: AsyncSession = Depends(get_db)):
    """
    ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ä»ªè¡¨æ¿æ•°æ®
    æ€§èƒ½: ä»4ä¸ªè¯·æ±‚åˆå¹¶ä¸º1ä¸ª
    """
    # å¹¶å‘æ‰§è¡Œæ‰€æœ‰æŸ¥è¯¢
    api_status, account, models, ai_health = await asyncio.gather(
        get_api_status(),
        get_account_info(db),
        get_models_data(db),
        get_ai_health(db),
        return_exceptions=True
    )
    
    return {
        "success": True,
        "data": {
            "api_status": api_status,
            "account": account,
            "models": models,
            "ai_health": ai_health
        },
        "timestamp": datetime.now()
    }
```

### 2. å‰ç«¯React Query

```typescript
// frontend/app/hooks/useDashboard.ts
import { useQuery } from '@tanstack/react-query';
import axios from 'axios';

export function useDashboard() {
  return useQuery({
    queryKey: ['dashboard'],
    queryFn: async () => {
      const { data } = await axios.get('/api/v1/dashboard/summary');
      return data.data;
    },
    staleTime: 30000,  // 30ç§’ç¼“å­˜
    refetchInterval: 30000,  // 30ç§’è‡ªåŠ¨åˆ·æ–°
  });
}

// ä½¿ç”¨
function Home() {
  const { data, isLoading } = useDashboard();
  
  if (isLoading) return <LoadingSkeleton />;
  
  return (
    <Dashboard 
      apiStatus={data.api_status}
      account={data.account}
      models={data.models}
      aiHealth={data.ai_health}
    />
  );
}
```

### 3. ä»£ç åˆ†å‰²

```typescript
// frontend/app/page.tsx
import dynamic from 'next/dynamic';

// æ‡’åŠ è½½éå…³é”®ç»„ä»¶
const PerformanceDashboard = dynamic(
  () => import('./components/performance/PerformanceDashboard'),
  { 
    ssr: false,
    loading: () => <LoadingSkeleton />
  }
);
```

---

## ğŸŠ é¢„æœŸæ”¶ç›Š

### ç”¨æˆ·ä½“éªŒ

- âœ… é¦–é¡µåŠ è½½: 5s â†’ 1.5s (70%æå‡)
- âœ… é¡µé¢åˆ‡æ¢: å³æ—¶å“åº”
- âœ… æ— é—ªçƒ: Skeleton loading
- âœ… æµç•…æ»šåŠ¨: å‡å°‘é‡æ¸²æŸ“

### å¼€å‘ä½“éªŒ

- âœ… ä»£ç æ›´æ¸…æ™°: ç»„ä»¶æ‹†åˆ†
- âœ… è°ƒè¯•æ›´å®¹æ˜“: React Query DevTools
- âœ… ç»´æŠ¤æ›´ç®€å•: ç»Ÿä¸€çš„æ•°æ®è·å–

### æœåŠ¡å™¨è´Ÿè½½

- âœ… APIè°ƒç”¨: å‡å°‘75%
- âœ… æ•°æ®åº“æŸ¥è¯¢: å‡å°‘60%
- âœ… å†…å­˜ä½¿ç”¨: å‡å°‘50%

---

**ä¼˜åŒ–è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**é¢„è®¡è€—æ—¶**: 1-2å¤© (åˆ†é˜¶æ®µå®æ–½)  
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ (ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒ)

